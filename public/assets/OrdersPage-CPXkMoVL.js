import{d as J,c as x,m as O,a as e,b as l,e as a,t as d,w as u,f as i,i as f,r as c,A as se,s as re,o as oe,z as ne,k as j,B as de,C as le,F as N,j as B,v as D,n as C,x as v}from"./index-DjU-SR4D.js";import{a as ae,_ as h}from"./CustomPagination.vue_vue_type_script_setup_true_lang-CV_l09hv.js";import{_ as U}from"./createLucideIcon-CpkhF4YH.js";import{_ as R,a as q,b as X,c as b}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CB1hvWUA.js";import{_ as ue}from"./Checkbox.vue_vue_type_script_setup_true_lang-C7j3AK5n.js";import{_ as ie}from"./Sidebar.vue_vue_type_script_setup_true_lang-sgM1v4lD.js";import{X as pe}from"./x-CN-yFgvQ.js";import{S as ce,F as H}from"./search-Ci8AtlRz.js";import{E as fe}from"./eye-DZXuA3u6.js";import"./index-OT-Qnd2y.js";import"./Teleport-B12evmlH.js";import"./PopperContent-B39yZlhX.js";import"./RovingFocusGroup-CMxlSFcM.js";import"./Collection-4N3OwyZ6.js";import"./check-CB_O76uP.js";import"./truck-CcAql6eW.js";import"./SheetTrigger.vue_vue_type_script_setup_true_lang-czE_r7b2.js";const xe={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},me={class:"bg-card border border-border rounded-lg max-w-2xl w-full max-h-[90vh] overflow-auto"},ge={class:"flex items-center justify-between p-6 border-b border-border sticky top-0 bg-card"},ve={class:"p-6 space-y-6",dir:"rtl"},_e={class:"grid grid-cols-2 gap-6"},be={class:"text-lg font-bold text-foreground"},ye={class:"text-lg font-bold text-primary capitalize"},ke={class:"bg-muted/30 rounded-lg p-4 space-y-3"},$e={class:"grid grid-cols-2 gap-4"},we={class:"text-sm text-foreground"},Ce={class:"text-sm text-foreground"},he={class:"col-span-2"},Oe={class:"text-sm text-foreground"},Se={class:"bg-muted/30 rounded-lg p-4 space-y-3"},Ee={class:"grid grid-cols-2 gap-4"},Fe={class:"text-sm text-foreground"},De={class:"text-sm text-foreground"},Ue={class:"col-span-2"},ze={class:"text-sm text-foreground"},Pe={key:0,class:"bg-muted/30 rounded-lg p-4 space-y-3"},je={class:"grid grid-cols-2 gap-4"},Ne={class:"text-sm text-foreground"},Be={class:"text-sm text-foreground"},Ie={class:"text-sm text-foreground capitalize"},Te={class:"text-sm text-foreground"},Ve={key:1,class:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-4"},Le={class:"bg-muted/30 rounded-lg p-4 space-y-3"},Me={class:"space-y-2 text-sm"},Ae={class:"flex justify-between"},Ge={class:"text-foreground font-medium"},Re={class:"flex justify-between"},qe={class:"text-foreground font-medium"},Xe={class:"border-t border-border pt-2 flex justify-between"},He={class:"text-foreground font-bold"},Je={key:2,class:"bg-muted/30 rounded-lg p-4"},Ke={class:"text-sm text-foreground"},Qe={class:"text-xs text-muted-foreground"},We={class:"flex gap-3 p-6 border-t border-border bg-muted/20"},Ye=J({__name:"OrderDitails",props:{order:{},isOpen:{type:Boolean},onEdit:{type:Function},onClose:{type:Function}},setup(I){const n=I;function y(g){switch(g){case"preparing":return"في التحضير";case"ready":return"جاهز للاستلام";case"picked-up":return"تم الاستلام";case"delivered":return"تم التوصيل";default:return"في التحضير"}}return(g,s)=>n.isOpen?(i(),x("div",xe,[e("div",me,[e("div",ge,[s[1]||(s[1]=e("h2",{class:"text-xl font-bold text-foreground"},"تفاصيل الطلب",-1)),e("button",{onClick:s[0]||(s[0]=(...k)=>n.onClose&&n.onClose(...k)),class:"p-1 hover:bg-muted rounded transition-colors"},[l(a(pe),{class:"w-5 h-5 text-foreground"})])]),e("div",ve,[e("div",_e,[e("div",null,[s[2]||(s[2]=e("p",{class:"text-xs text-muted-foreground uppercase"},"رقم الطلب",-1)),e("p",be," #"+d(n.order.order_id),1)]),e("div",null,[s[3]||(s[3]=e("p",{class:"text-xs text-muted-foreground uppercase"},"الحالة",-1)),e("p",ye,d(y(n.order.order_status)),1)])]),e("div",ke,[s[7]||(s[7]=e("h3",{class:"font-semibold text-foreground"},"معلومات العميل",-1)),e("div",$e,[e("div",null,[s[4]||(s[4]=e("p",{class:"text-xs text-muted-foreground"},"الاسم",-1)),e("p",we,d(n.order.user_name||"غير معروف"),1)]),e("div",null,[s[5]||(s[5]=e("p",{class:"text-xs text-muted-foreground"},"الهاتف",-1)),e("p",Ce,d(n.order?.user_phone||"غير متوفر"),1)]),e("div",he,[s[6]||(s[6]=e("p",{class:"text-xs text-muted-foreground"},"العنوان",-1)),e("p",Oe,d(n.order?.user_address||"غير متوفر"),1)])])]),e("div",Se,[s[11]||(s[11]=e("h3",{class:"font-semibold text-foreground"},"معلومات المطعم",-1)),e("div",Ee,[e("div",null,[s[8]||(s[8]=e("p",{class:"text-xs text-muted-foreground"},"الاسم",-1)),e("p",Fe,d(n.order?.restaurant_name||"غير معروف"),1)]),e("div",null,[s[9]||(s[9]=e("p",{class:"text-xs text-muted-foreground"},"المدينة",-1)),e("p",De,d(n.order?.restaurant_city||"غير متوفر"),1)]),e("div",Ue,[s[10]||(s[10]=e("p",{class:"text-xs text-muted-foreground"},"العنوان",-1)),e("p",ze,d(n.order?.restaurant_address||"غير متوفر"),1)])])]),n.order.driver_id?(i(),x("div",Pe,[s[16]||(s[16]=e("h3",{class:"font-semibold text-foreground"},"معلومات السائق",-1)),e("div",je,[e("div",null,[s[12]||(s[12]=e("p",{class:"text-xs text-muted-foreground"},"الاسم",-1)),e("p",Ne,d(n.order.driver_full_name),1)]),e("div",null,[s[13]||(s[13]=e("p",{class:"text-xs text-muted-foreground"},"الهاتف",-1)),e("p",Be,d(n.order.driver_phone),1)]),e("div",null,[s[14]||(s[14]=e("p",{class:"text-xs text-muted-foreground"},"المركبة",-1)),e("p",Ie,d(n.order.driver_type),1)]),e("div",null,[s[15]||(s[15]=e("p",{class:"text-xs text-muted-foreground"},"رقم اللوحة",-1)),e("p",Te,d(n.order.plate_number),1)])])])):(i(),x("div",Ve,[...s[17]||(s[17]=[e("p",{class:"text-sm text-orange-700"}," لم يتم تعيين سائق لهذا الطلب بعد ",-1)])])),e("div",Le,[s[21]||(s[21]=e("h3",{class:"font-semibold text-foreground"},"ملخص الطلب",-1)),e("div",Me,[e("div",Ae,[s[18]||(s[18]=e("span",{class:"text-muted-foreground"},"إجمالي الطلب:",-1)),e("span",Ge,d(n.order.order_total_price)+" ج.م",1)]),e("div",Re,[s[19]||(s[19]=e("span",{class:"text-muted-foreground"},"تكلفة التوصيل:",-1)),e("span",qe,d(n.order.order_delivery_cost)+" ج.م",1)]),e("div",Xe,[s[20]||(s[20]=e("span",{class:"text-foreground font-medium"},"الإجمالي الكلي:",-1)),e("span",He,d(n.order.order_total_price)+" ج.م",1)])])]),n.order.order_notes?(i(),x("div",Je,[s[22]||(s[22]=e("h3",{class:"font-semibold text-foreground mb-2"},"ملاحظات",-1)),e("p",Ke,d(n.order.order_notes),1)])):O("",!0),e("div",Qe," تم إنشاء الطلب في "+d(new Date(n.order.created_at).toLocaleString("ar-EG")),1)]),e("div",We,[l(a(U),{onClick:n.onClose,variant:"outline"},{default:u(()=>[...s[23]||(s[23]=[f("إغلاق",-1)])]),_:1},8,["onClick"])])])])):O("",!0)}}),Ze={class:"flex h-screen bg-background"},et={class:"w-full flex flex-col p-8 space-y-6"},tt={class:"flex flex-col sm:flex-row gap-4"},st={class:"flex-1 relative"},rt={class:"flex gap-2"},ot={class:"grid grid-cols-4 gap-2"},nt={class:"drivers border rounded-lg"},dt=["onClick"],lt={key:1,class:"m-auto text-center"},at={class:"col-span-3 bg-card border rounded-lg"},ut={class:"overflow-x-auto"},it={class:"w-full"},pt={key:0},ct={class:"px-6 py-4 text-sm font-medium text-foreground"},ft={class:"px-6 py-4 text-sm text-foreground"},xt={class:"px-6 py-4 text-sm font-medium text-foreground"},mt={class:"px-6 py-4 text-sm text-foreground"},gt={class:"px-6 py-4 text-sm text-foreground"},vt={class:"px-6 py-4 text-sm text-foreground"},_t={class:"relative px-6 py-4 group"},bt={class:"hidden absolute z-50 bg-white rounded border p-2 group-hover:flex items-center flex-col gap-2"},yt={class:"px-6 py-4 text-sm text-muted-foreground"},kt={class:"px-6 py-4 text-right flex items-center gap-2"},$t=50,Lt=J({__name:"OrdersPage",setup(I){const n=c(""),y=c(null),g=c(null),s=c(1),k=c(null),S=c(!1),T=c(0),m=c([]);let E=null;const V=c([]),L=se({get(){const o={};for(const t of m.value)o[t]=!0;return o},set(o){m.value=Object.keys(o).filter(t=>o[Number(t)]).map(Number)}});function K(o,t=500){let r;return(...p)=>{clearTimeout(r),r=window.setTimeout(()=>o(...p),t)}}const z=c([]),_=async()=>{try{const o=new URLSearchParams;o.append("page",s.value.toString()),n.value.trim()!==""&&o.append("search",encodeURIComponent(n.value.trim())),y.value&&o.append("status",y.value),g.value&&o.append("city",g.value);const t=await D.get(`/orders/admin?${o.toString()}`);z.value=t.data.orders,T.value=t.data.totalOrders,V.value=t.data.cities.map(r=>r.city_name)}catch(o){console.error("حدث خطأ أثناء جلب البيانات:",o)}},Q=K(_,500),$=o=>{y.value=o,s.value=1,_()},M=o=>{g.value=o,s.value=1,_()},w=o=>{switch(o){case"preparing":return"bg-orange-500/10 text-orange-700 hover:bg-orange-500/20";case"ready":return"bg-yellow-500/10 text-yellow-700 hover:bg-yellow-500/20";case"picked-up":return"bg-blue-500/10 text-blue-700 hover:bg-blue-500/20";case"delivered":return"bg-green-500/10 text-green-700 hover:bg-green-500/20";default:return"bg-gray-500/10 text-gray-700 hover:bg-gray-500/20"}};function W(o){switch(o){case"preparing":return"في التحضير";case"ready":return"جاهز للاستلام";case"picked-up":return"تم الاستلام";case"delivered":return"تم التوصيل";default:return"في التحضير"}}async function F(o,t){try{(await D.put(`/orders/admin/${o}`,{order_status:t})).data.success&&(v.success(`تم تحديث حالة الطلب رقم ${o} بنجاح`),await _())}catch(r){if(r.response){const p=r.response.data?.message||"حدث خطأ أثناء تعديل حالة الطلب";console.error("API Error:",r.response),v.error(p);return}if(r.request){console.error("Network Error:",r.request),v.error("تعذر الاتصال بالسيرفر");return}console.error("Unexpected Error:",r),v.error("حدث خطأ غير متوقع")}}function Y(o){k.value=o,S.value=!0}function Z(o){if(!m.value.includes(o)){m.value.push(o);return}m.value=m.value.filter(t=>t!==o)}function ee(o){switch(o){case"picked-up":return!1;case"delivered":return!1;default:return!0}}const P=c([]),A=c(!1),G=async()=>{try{A.value=!0;const o=await D.get("/driver/active");P.value=o.data.drivers}catch(o){console.error("حدث خطأ أثناء جلب السائقين:",o)}finally{A.value=!1}},te=async o=>{if(!o){v.error("اختر سائق أولاً");return}if(m.value.length===0){v.error("اختر طلب واحد على الأقل");return}try{await D.post("/orders/assign",{driver_id:o,orders:m.value}),v.success("تم تعيين السائق بنجاح"),m.value=[],await _()}catch(t){console.error("حدث خطأ أثناء تعيين السائق:",t),v.error("فشل تعيين السائق")}};return re(n,()=>{Q()}),oe(async()=>{await _(),await G(),E=window.setInterval(()=>{G()},2e4)}),ne(()=>{E&&(clearInterval(E),E=null)}),(o,t)=>(i(),x("div",Ze,[l(ie),e("div",et,[t[25]||(t[25]=e("div",null,[e("h1",{class:"text-3xl font-bold text-foreground"},"الطلبات"),e("p",{class:"text-muted-foreground mt-1"}," إدارة ومتابعة جميع طلبات التوصيل ")],-1)),e("div",tt,[e("div",st,[l(a(ce),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),de(e("input",{type:"text",placeholder:"ابحث برقم الطلب...","onUpdate:modelValue":t[0]||(t[0]=r=>n.value=r),class:"w-full pl-10 pr-4 py-2 bg-card border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[le,n.value]])]),e("div",rt,[l(a(R),null,{default:u(()=>[l(a(q),{asChild:""},{default:u(()=>[l(a(U),{variant:"outline",size:"sm",class:"gap-2 bg-transparent"},{default:u(()=>[l(a(H),{class:"w-4 h-4"}),f(" "+d(g.value?`المدينة: ${g.value}`:"المدينة"),1)]),_:1})]),_:1}),l(a(X),null,{default:u(()=>[l(a(b),{onClick:t[1]||(t[1]=r=>M(null))},{default:u(()=>[...t[10]||(t[10]=[f("كل المدن",-1)])]),_:1}),(i(!0),x(N,null,B(V.value,r=>(i(),j(a(b),{key:r,onClick:p=>M(r)},{default:u(()=>[f(d(r),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),l(a(R),null,{default:u(()=>[l(a(q),{asChild:""},{default:u(()=>[l(a(U),{variant:"outline",size:"sm",class:"gap-2 bg-transparent"},{default:u(()=>[l(a(H),{class:"w-4 h-4"}),t[11]||(t[11]=f(" الحالة ",-1))]),_:1})]),_:1}),l(a(X),null,{default:u(()=>[l(a(b),{onClick:t[2]||(t[2]=r=>$(null))},{default:u(()=>[...t[12]||(t[12]=[f(" كل الطلبات ",-1)])]),_:1}),l(a(b),{onClick:t[3]||(t[3]=r=>$("pending"))},{default:u(()=>[...t[13]||(t[13]=[f(" قيد الانتظار ",-1)])]),_:1}),l(a(b),{onClick:t[4]||(t[4]=r=>$("ready"))},{default:u(()=>[...t[14]||(t[14]=[f(" جاهز للاستلام ",-1)])]),_:1}),l(a(b),{onClick:t[5]||(t[5]=r=>$("picked-up"))},{default:u(()=>[...t[15]||(t[15]=[f(" تم التعيين ",-1)])]),_:1}),l(a(b),{onClick:t[6]||(t[6]=r=>$("delivered"))},{default:u(()=>[...t[16]||(t[16]=[f(" تم التسليم ",-1)])]),_:1})]),_:1})]),_:1})])]),e("div",ot,[e("div",nt,[P.value.length>0?(i(!0),x(N,{key:0},B(P.value,r=>(i(),x("div",{class:"driver text-right py-1 px-1 border-b cursor-pointer",key:r.driver_id,onClick:p=>te(r.driver_id)},[e("p",null,d(r.driver_name),1),e("p",null,d(r.driver_city),1)],8,dt))),128)):(i(),x("div",lt,[...t[17]||(t[17]=[e("p",null,"لا يوجد سأقين موتحين",-1)])]))]),e("div",at,[e("div",ut,[e("table",it,[t[24]||(t[24]=e("thead",null,[e("tr",{class:"border-b border-border bg-muted/30"},[e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," رقم الطلب "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," المطعم "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," الإجمالي "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," التوصيل "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," السائق "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," المدينه "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," الحالة "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," التاريخ "),e("th",{class:"px-6 py-4 text-right text-xs font-medium text-muted-foreground uppercase"}," الإجراءات ")])],-1)),e("tbody",null,[z.value.length===0?(i(),x("tr",pt,[...t[18]||(t[18]=[e("td",{colspan:"9",class:"px-6 py-8 text-center text-muted-foreground"}," لا يوجد طلبات ",-1)])])):O("",!0),(i(!0),x(N,null,B(z.value,r=>(i(),x("tr",{key:r.order_id,class:"border-b border-border hover:bg-muted/50 transition-colors"},[e("td",ct," #"+d(r.order_id),1),e("td",ft,d(r.restaurant_name),1),e("td",xt," ج.م "+d(r.order_total_price.toFixed(2)),1),e("td",mt," ج.م "+d(r.order_delivery_cost.toFixed(2)),1),e("td",gt,d(r.driver_full_name||"غير مخصص"),1),e("td",vt,d(r.order_city),1),e("td",_t,[l(a(h),{class:C(w(r.order_status))},{default:u(()=>[f(d(W(r.order_status)),1)]),_:2},1032,["class"]),e("div",bt,[l(a(h),{class:C([w("preparing"),"w-full cursor-pointer"]),onClick:p=>F(r.order_id,"preparing")},{default:u(()=>[...t[19]||(t[19]=[e("p",null,"في التحضير",-1)])]),_:1},8,["class","onClick"]),l(a(h),{class:C([w("ready"),"w-full cursor-pointer"]),onClick:p=>F(r.order_id,"ready")},{default:u(()=>[...t[20]||(t[20]=[e("p",null,"جاهز للاستلام",-1)])]),_:1},8,["class","onClick"]),l(a(h),{class:C([w("picked-up"),"w-full cursor-pointer"]),onClick:p=>F(r.order_id,"picked-up")},{default:u(()=>[...t[21]||(t[21]=[e("p",null,"تم الاستلام",-1)])]),_:1},8,["class","onClick"]),l(a(h),{class:C([w("delivered"),"w-full cursor-pointer"]),onClick:p=>F(r.order_id,"delivered")},{default:u(()=>[...t[22]||(t[22]=[e("p",null,"تم التوصيل",-1)])]),_:1},8,["class","onClick"])])]),e("td",yt,d(new Date(r.created_at).toLocaleDateString("ar-EG")),1),e("td",kt,[l(a(U),{onClick:p=>Y(r)},{default:u(()=>[l(a(fe),{class:"w-4 h-4 mr-2"}),t[23]||(t[23]=f(" التفاصيل ",-1))]),_:1},8,["onClick"]),ee(r.order_status)?(i(),j(a(ue),{key:0,onClick:p=>Z(r.order_id),checked:L.value[r.order_id],"onUpdate:checked":p=>L.value[r.order_id]=p},null,8,["onClick","checked","onUpdate:checked"])):O("",!0)])]))),128))])])]),l(ae,{"current-page":s.value,"total-items":T.value,"items-per-page":$t,"onUpdate:currentPage":t[7]||(t[7]=r=>s.value=r)},null,8,["current-page","total-items"])])]),k.value?(i(),j(Ye,{key:0,order:k.value,isOpen:S.value,onClose:t[8]||(t[8]=r=>S.value=!1),onEdit:t[9]||(t[9]=()=>{S.value=!1,_()})},null,8,["order","isOpen"])):O("",!0)])]))}});export{Lt as default};

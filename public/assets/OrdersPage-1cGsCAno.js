import{d as N,f,e as g,p as w,b as e,a as o,u as r,t as l,w as a,c as E,o as p,F as P,k as T,j as i,A as L,g as q,h as H,z as J,v as K,x as Q,n as W}from"./index-d-g9mRbR.js";import{_ as Y}from"./index-cBp-nCgD.js";import{_ as k,b as B,d as Z}from"./auth-BOWgCVVb.js";import{_ as V,a as z,b as j,c as b}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-D8Ok4xwk.js";import{_ as ee,E as te}from"./CustomPagination.vue_vue_type_script_setup_true_lang-DpwOP1tr.js";import{_ as se}from"./Sidebar.vue_vue_type_script_setup_true_lang-CIwOqECK.js";import{_ as re,a as oe,b as de,c as ne,d as le}from"./SelectValue.vue_vue_type_script_setup_true_lang-BxzYEQ-R.js";import{X as ae}from"./x-BIILnT8m.js";import{S as ue,F as M}from"./search-BEWjTuhG.js";import{E as ie}from"./eye-CdV7MRcD.js";import"./index-DYTBgUmH.js";import"./useForwardPropsEmits-D6-NodRW.js";import"./PopperContent-BvjY67ll.js";import"./house-DvnnnsCD.js";import"./truck-J7k0Gy93.js";import"./mail-BeP-FzBI.js";const pe={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},fe={class:"bg-card border border-border rounded-lg max-w-2xl w-full max-h-[90vh] overflow-auto"},xe={class:"flex items-center justify-between p-6 border-b border-border sticky top-0 bg-card"},me={class:"p-6 space-y-6",dir:"rtl"},ce={class:"grid grid-cols-2 gap-6"},ge={class:"text-lg font-bold text-foreground"},ve={class:"text-lg font-bold text-primary capitalize"},_e={class:"bg-muted/30 rounded-lg p-4 space-y-3"},be={class:"grid grid-cols-2 gap-4"},ye={class:"text-sm text-foreground"},$e={class:"text-sm text-foreground"},we={class:"col-span-2"},ke={class:"text-sm text-foreground"},Ce={class:"bg-muted/30 rounded-lg p-4 space-y-3"},he={class:"grid grid-cols-2 gap-4"},Se={class:"text-sm text-foreground"},Ee={class:"text-sm text-foreground"},De={class:"col-span-2"},Fe={class:"text-sm text-foreground"},Oe={key:0,class:"bg-muted/30 rounded-lg p-4 space-y-3"},Ve={class:"grid grid-cols-2 gap-4"},ze={class:"text-sm text-foreground"},je={class:"text-sm text-foreground"},Pe={class:"text-sm text-foreground capitalize"},Te={class:"text-sm text-foreground"},Be={key:1,class:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-4"},Ue={class:"bg-muted/30 rounded-lg p-4 space-y-3"},Ae={class:"space-y-2 text-sm"},Le={class:"flex justify-between"},Me={class:"text-foreground font-medium"},Ne={class:"flex justify-between"},Re={class:"text-foreground font-medium"},Ge={class:"border-t border-border pt-2 flex justify-between"},Ie={class:"text-foreground font-bold"},Xe={key:2,class:"bg-muted/30 rounded-lg p-4"},qe={class:"text-sm text-foreground"},He={class:"text-xs text-muted-foreground"},Je={key:0,class:"w-full flex px-6 gap-3 my-3",dir:"rtl"},Ke={class:"flex gap-3 p-6 border-t border-border bg-muted/20"},Qe=N({__name:"OrderDitails",props:{order:{},isOpen:{type:Boolean},onEdit:{type:Function},onClose:{type:Function}},setup(U){const d=U;function D(c){switch(c){case"preparing":return"في التحضير";case"ready":return"جاهز للاستلام";case"picked-up":return"تم الاستلام";case"delivered":return"تم التوصيل";default:return"في التحضير"}}const x=f(!1),y=f([]),m=f(null),v=f(!1),C=async()=>{try{v.value=!0;const c=await B.get(`/driver?active=true&city=${d.order.restaurant_city}`);y.value=c.data.drivers,x.value=!0}catch(c){console.error("حدث خطأ أثناء جلب السائقين:",c)}finally{v.value=!1}},$=async()=>{if(!m.value)return alert("اختر سائق أولاً");try{await B.post(`/orders/assign/${d.order.order_id}`,{driver_id:m.value}),L.success("تم تعيين السائق بنجاح"),x.value=!1,d.onEdit()}catch(c){console.error("حدث خطأ أثناء تعيين السائق:",c),L.error("فشل تعيين السائق")}};return(c,t)=>d.isOpen?(p(),g("div",pe,[e("div",fe,[e("div",xe,[t[3]||(t[3]=e("h2",{class:"text-xl font-bold text-foreground"},"تفاصيل الطلب",-1)),e("button",{onClick:t[0]||(t[0]=(..._)=>d.onClose&&d.onClose(..._)),class:"p-1 hover:bg-muted rounded transition-colors"},[o(r(ae),{class:"w-5 h-5 text-foreground"})])]),e("div",me,[e("div",ce,[e("div",null,[t[4]||(t[4]=e("p",{class:"text-xs text-muted-foreground uppercase"},"رقم الطلب",-1)),e("p",ge," #"+l(d.order.order_id),1)]),e("div",null,[t[5]||(t[5]=e("p",{class:"text-xs text-muted-foreground uppercase"},"الحالة",-1)),e("p",ve,l(D(d.order.order_status)),1)])]),e("div",_e,[t[9]||(t[9]=e("h3",{class:"font-semibold text-foreground"},"معلومات العميل",-1)),e("div",be,[e("div",null,[t[6]||(t[6]=e("p",{class:"text-xs text-muted-foreground"},"الاسم",-1)),e("p",ye,l(d.order.user_name||"غير معروف"),1)]),e("div",null,[t[7]||(t[7]=e("p",{class:"text-xs text-muted-foreground"},"الهاتف",-1)),e("p",$e,l(d.order?.user_phone||"غير متوفر"),1)]),e("div",we,[t[8]||(t[8]=e("p",{class:"text-xs text-muted-foreground"},"العنوان",-1)),e("p",ke,l(d.order?.user_address||"غير متوفر"),1)])])]),e("div",Ce,[t[13]||(t[13]=e("h3",{class:"font-semibold text-foreground"},"معلومات المطعم",-1)),e("div",he,[e("div",null,[t[10]||(t[10]=e("p",{class:"text-xs text-muted-foreground"},"الاسم",-1)),e("p",Se,l(d.order?.restaurant_name||"غير معروف"),1)]),e("div",null,[t[11]||(t[11]=e("p",{class:"text-xs text-muted-foreground"},"المدينة",-1)),e("p",Ee,l(d.order?.restaurant_city||"غير متوفر"),1)]),e("div",De,[t[12]||(t[12]=e("p",{class:"text-xs text-muted-foreground"},"العنوان",-1)),e("p",Fe,l(d.order?.restaurant_address||"غير متوفر"),1)])])]),d.order.driver_id?(p(),g("div",Oe,[t[18]||(t[18]=e("h3",{class:"font-semibold text-foreground"},"معلومات السائق",-1)),e("div",Ve,[e("div",null,[t[14]||(t[14]=e("p",{class:"text-xs text-muted-foreground"},"الاسم",-1)),e("p",ze,l(d.order.driver_full_name),1)]),e("div",null,[t[15]||(t[15]=e("p",{class:"text-xs text-muted-foreground"},"الهاتف",-1)),e("p",je,l(d.order.driver_phone),1)]),e("div",null,[t[16]||(t[16]=e("p",{class:"text-xs text-muted-foreground"},"المركبة",-1)),e("p",Pe,l(d.order.driver_type),1)]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-xs text-muted-foreground"},"رقم اللوحة",-1)),e("p",Te,l(d.order.plate_number),1)])])])):(p(),g("div",Be,[...t[19]||(t[19]=[e("p",{class:"text-sm text-orange-700"}," لم يتم تعيين سائق لهذا الطلب بعد ",-1)])])),e("div",Ue,[t[23]||(t[23]=e("h3",{class:"font-semibold text-foreground"},"ملخص الطلب",-1)),e("div",Ae,[e("div",Le,[t[20]||(t[20]=e("span",{class:"text-muted-foreground"},"إجمالي الطلب:",-1)),e("span",Me,l(d.order.order_total_price)+" ج.م",1)]),e("div",Ne,[t[21]||(t[21]=e("span",{class:"text-muted-foreground"},"تكلفة التوصيل:",-1)),e("span",Re,l(d.order.order_delivery_cost)+" ج.م",1)]),e("div",Ge,[t[22]||(t[22]=e("span",{class:"text-foreground font-medium"},"الإجمالي الكلي:",-1)),e("span",Ie,l(d.order.order_total_price)+" ج.م",1)])])]),d.order.order_notes?(p(),g("div",Xe,[t[24]||(t[24]=e("h3",{class:"font-semibold text-foreground mb-2"},"ملاحظات",-1)),e("p",qe,l(d.order.order_notes),1)])):w("",!0),e("div",He," تم إنشاء الطلب في "+l(new Date(d.order.created_at).toLocaleString("ar-EG")),1)]),x.value?(p(),g("div",Je,[o(r(re),{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=_=>m.value=_)},{default:a(()=>[o(r(oe),{class:"w-[200px]"},{default:a(()=>[o(r(de),{placeholder:"اختر سائقًا"})]),_:1}),o(r(ne),null,{default:a(()=>[(p(!0),g(P,null,T(y.value,_=>(p(),E(r(le),{key:_.driver_id,value:_.driver_id.toString()},{default:a(()=>[i(l(_.driver_name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),o(r(k),{onClick:$,disabled:!m.value},{default:a(()=>[...t[25]||(t[25]=[i("حفظ",-1)])]),_:1},8,["disabled"]),o(r(k),{onClick:t[2]||(t[2]=_=>x.value=!1),variant:"outline"},{default:a(()=>[...t[26]||(t[26]=[i("اغلاق",-1)])]),_:1})])):w("",!0),e("div",Ke,[o(r(k),{onClick:d.onClose,variant:"outline"},{default:a(()=>[...t[27]||(t[27]=[i("إغلاق",-1)])]),_:1},8,["onClick"]),!x.value&&d.order.order_status!=="delivered"?(p(),E(r(k),{key:0,onClick:C,disabled:v.value},{default:a(()=>[i(l(v.value?"جارٍ التحميل...":"تعيين سائق"),1)]),_:1},8,["disabled"])):w("",!0)])])])):w("",!0)}}),We={class:"flex h-screen bg-background"},Ye={class:"w-full flex flex-col p-8 space-y-6"},Ze={class:"flex flex-col sm:flex-row gap-4"},et={class:"flex-1 relative"},tt={class:"flex gap-2"},st={class:"bg-card border border-border rounded-lg overflow-hidden"},rt={class:"overflow-x-auto"},ot={class:"w-full"},dt={key:0},nt={class:"px-6 py-4 text-sm font-medium text-foreground"},lt={class:"px-6 py-4 text-sm text-foreground"},at={class:"px-6 py-4 text-sm text-foreground"},ut={class:"px-6 py-4 text-sm font-medium text-foreground"},it={class:"px-6 py-4 text-sm text-foreground"},pt={class:"px-6 py-4 text-sm text-foreground"},ft={class:"px-6 py-4"},xt={class:"px-6 py-4 text-sm text-muted-foreground"},mt={class:"px-6 py-4 text-right"},ct={class:"p-1.5 hover:bg-muted rounded transition-colors"},gt=50,jt=N({__name:"OrdersPage",setup(U){const d=Z(),D=H(),x=f(""),y=f(null),m=f(null),v=f(1),C=f(null),$=f(!1),c=f(0),t=f([]);function _(u,s=500){let n;return(...O)=>{clearTimeout(n),n=window.setTimeout(()=>u(...O),s)}}const F=f([]),h=async()=>{try{const u=new URLSearchParams;u.append("page",v.value.toString()),x.value.trim()!==""&&u.append("search",encodeURIComponent(x.value.trim())),y.value&&u.append("status",y.value),m.value&&u.append("city",m.value);const s=await B.get(`/orders/admin?${u.toString()}`,{});F.value=s.data.orders,c.value=s.data.totalOrders,t.value=s.data.cities.map(n=>n.city_name)}catch(u){console.error("حدث خطأ أثناء جلب البيانات:",u)}};q(async()=>{await d.init(),d.isAuthenticated||(d.logout(),D.push("/management")),h()});const R=_(h,500),S=u=>{y.value=u,v.value=1,h()},A=u=>{m.value=u,v.value=1,h()},G=u=>{switch(u){case"pending":return"bg-orange-500/10 text-orange-700 hover:bg-orange-500/20";case"assigned":return"bg-blue-500/10 text-blue-700 hover:bg-blue-500/20";case"delivered":return"bg-green-500/10 text-green-700 hover:bg-green-500/20";default:return"bg-gray-500/10 text-gray-700 hover:bg-gray-500/20"}};function I(u){switch(u){case"preparing":return"في التحضير";case"ready":return"جاهز للاستلام";case"picked-up":return"تم الاستلام";case"delivered":return"تم التوصيل";default:return"في التحضير"}}function X(u){C.value=u,$.value=!0}return J(x,()=>{R()}),(u,s)=>(p(),g("div",We,[o(se),e("div",Ye,[s[20]||(s[20]=e("div",null,[e("h1",{class:"text-3xl font-bold text-foreground"},"الطلبات"),e("p",{class:"text-muted-foreground mt-1"}," إدارة ومتابعة جميع طلبات التوصيل ")],-1)),e("div",Ze,[e("div",et,[o(r(ue),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),K(e("input",{type:"text",placeholder:"ابحث برقم الطلب...","onUpdate:modelValue":s[0]||(s[0]=n=>x.value=n),class:"w-full pl-10 pr-4 py-2 bg-card border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[Q,x.value]])]),e("div",tt,[o(r(V),null,{default:a(()=>[o(r(z),{asChild:""},{default:a(()=>[o(r(k),{variant:"outline",size:"sm",class:"gap-2 bg-transparent"},{default:a(()=>[o(r(M),{class:"w-4 h-4"}),i(" "+l(m.value?`المدينة: ${m.value}`:"المدينة"),1)]),_:1})]),_:1}),o(r(j),null,{default:a(()=>[o(r(b),{onClick:s[1]||(s[1]=n=>A(null))},{default:a(()=>[...s[10]||(s[10]=[i("كل المدن",-1)])]),_:1}),(p(!0),g(P,null,T(t.value,n=>(p(),E(r(b),{key:n,onClick:O=>A(n)},{default:a(()=>[i(l(n),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),o(r(V),null,{default:a(()=>[o(r(z),{asChild:""},{default:a(()=>[o(r(k),{variant:"outline",size:"sm",class:"gap-2 bg-transparent"},{default:a(()=>[o(r(M),{class:"w-4 h-4"}),s[11]||(s[11]=i(" الحالة ",-1))]),_:1})]),_:1}),o(r(j),null,{default:a(()=>[o(r(b),{onClick:s[2]||(s[2]=n=>S(null))},{default:a(()=>[...s[12]||(s[12]=[i(" كل الطلبات ",-1)])]),_:1}),o(r(b),{onClick:s[3]||(s[3]=n=>S("pending"))},{default:a(()=>[...s[13]||(s[13]=[i(" قيد الانتظار ",-1)])]),_:1}),o(r(b),{onClick:s[4]||(s[4]=n=>S("ready"))},{default:a(()=>[...s[14]||(s[14]=[i(" جاهز للاستلام ",-1)])]),_:1}),o(r(b),{onClick:s[5]||(s[5]=n=>S("picked-up"))},{default:a(()=>[...s[15]||(s[15]=[i(" تم التعيين ",-1)])]),_:1}),o(r(b),{onClick:s[6]||(s[6]=n=>S("delivered"))},{default:a(()=>[...s[16]||(s[16]=[i(" تم التسليم ",-1)])]),_:1})]),_:1})]),_:1})])]),e("div",st,[e("div",rt,[e("table",ot,[s[19]||(s[19]=e("thead",null,[e("tr",{class:"border-b border-border bg-muted/30"},[e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," رقم الطلب "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," العميل "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," المطعم "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," الإجمالي "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," التوصيل "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," السائق "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," الحالة "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," التاريخ "),e("th",{class:"px-6 py-4 text-right text-xs font-medium text-muted-foreground uppercase"}," الإجراءات ")])],-1)),e("tbody",null,[F.value.length===0?(p(),g("tr",dt,[...s[17]||(s[17]=[e("td",{colspan:"9",class:"px-6 py-8 text-center text-muted-foreground"}," لا يوجد طلبات ",-1)])])):w("",!0),(p(!0),g(P,null,T(F.value,n=>(p(),g("tr",{key:n.order_id,class:"border-b border-border hover:bg-muted/50 transition-colors"},[e("td",nt," #"+l(n.order_id),1),e("td",lt,l(n.user_name),1),e("td",at,l(n.restaurant_name),1),e("td",ut," ج.م "+l(n.order_total_price.toFixed(2)),1),e("td",it," ج.م "+l(n.order_delivery_cost.toFixed(2)),1),e("td",pt,l(n.driver_name||"غير مخصص"),1),e("td",ft,[o(r(Y),{class:W(G(n.order_status))},{default:a(()=>[i(l(I(n.order_status)),1)]),_:2},1032,["class"])]),e("td",xt,l(new Date(n.created_at).toLocaleDateString("ar-EG")),1),e("td",mt,[o(r(V),null,{default:a(()=>[o(r(z),{asChild:""},{default:a(()=>[e("button",ct,[o(r(te),{class:"w-4 h-4 text-muted-foreground"})])]),_:1}),o(r(j),{align:"end"},{default:a(()=>[o(r(b),{onClick:O=>X(n)},{default:a(()=>[o(r(ie),{class:"w-4 h-4 mr-2"}),s[18]||(s[18]=i(" عرض التفاصيل ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)])]))),128))])])]),o(ee,{"current-page":v.value,"total-items":c.value,"items-per-page":gt,"onUpdate:currentPage":s[7]||(s[7]=n=>v.value=n)},null,8,["current-page","total-items"])]),C.value?(p(),E(Qe,{key:0,order:C.value,isOpen:$.value,onClose:s[8]||(s[8]=n=>$.value=!1),onEdit:s[9]||(s[9]=()=>{$.value=!1,h()})},null,8,["order","isOpen"])):w("",!0)])]))}});export{jt as default};

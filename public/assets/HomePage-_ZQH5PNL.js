import{_ as G,a as J,b as K,c as Q,d as X}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Bd8clJB1.js";import{_ as Y,a as Z}from"./Header.vue_vue_type_script_setup_true_lang-CsM1UwTE.js";import{c as ee,_ as w}from"./createLucideIcon-CsQdoSwz.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-CkF3edwu.js";import{_ as j}from"./Label.vue_vue_type_script_setup_true_lang-CymdxQ0O.js";import{_ as te}from"./Textarea.vue_vue_type_script_setup_true_lang-DZIN-sSh.js";import{d as L,f as _,x as N,c as h,w as a,u as r,o as g,a as s,b as o,k as m,t as p,y as U,z as C,g as q,e as V,n as re,p as se,q as P,A as T,B as oe,h as ae,F as A,l as de}from"./index-C5NPDLxV.js";import{_ as le}from"./index-I9WKBWZ2.js";import{C as B}from"./clock-CtuqvWAT.js";import{T as ne,P as ie}from"./truck-Cz75DKe_.js";import{_ as E,a as I,b as O,c as F}from"./CardTitle.vue_vue_type_script_setup_true_lang-CBxe4J3O.js";import{_ as ue}from"./CardDescription.vue_vue_type_script_setup_true_lang-49_jE5iZ.js";import{u as ce}from"./useWebSocket-D4NO8KuR.js";import{_ as me}from"./CustomPagination.vue_vue_type_script_setup_true_lang-Dg6h4slZ.js";import{C as fe}from"./circle-check-big-CJaKUxAE.js";import"./useForwardPropsEmits-Dvl0W8HD.js";import"./DialogTitle-Rq1bJPJW.js";import"./index-DmxO9ILx.js";import"./Teleport-DG6z2lou.js";import"./x-CUtjdDId.js";import"./DialogTrigger-DVsMfrUK.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-B0FAWFRc.js";import"./Collection-YunEvKz8.js";import"./check-a5TxdJkG.js";import"./PopperContent-Dposcc7J.js";import"./SelectLabel.vue_vue_type_script_setup_true_lang-D4v1WdiU.js";import"./loader-B2BrVlWD.js";import"./users-C5RuwNL5.js";import"./house-D0NNoEeP.js";const _e=ee("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),pe={class:"grid gap-4 py-4"},ve={class:"grid gap-2"},ge={class:"grid gap-2"},ye={class:"grid gap-2"},xe=L({__name:"EditOrders",props:{open:{type:Boolean},order:{}},emits:["update:open"],setup(d,{emit:S}){const x=d,$=S,u=_(!1),c=_({order_total_price:0,order_delivery_cost:0,notes:"",restaurant_id:0});N(()=>x.order,f=>{f&&(c.value={order_total_price:f.order_total_price||0,order_delivery_cost:f.order_delivery_cost||0,notes:f.order_notes||"",restaurant_id:f.restaurant_id})},{immediate:!0});const y=()=>{$("update:open",!1)},k=async()=>{if(x.order){u.value=!0;try{await U.put(`/orders/${x.order.order_id}`,c.value),C.success("تم تحديث الطلب بنجاح!"),y()}catch(f){C.error(f.response?.data?.message||"فشل تحديث الطلب")}finally{u.value=!1}}};return(f,n)=>(g(),h(r(G),{open:d.open,"onUpdate:open":y},{default:a(()=>[s(r(X),{class:"sm:max-w-[600px]",dir:"rtl"},{default:a(()=>[s(r(J),null,{default:a(()=>[s(r(K),null,{default:a(()=>[m("تعديل الطلب #"+p(d.order?.order_id),1)]),_:1}),s(r(Y),null,{default:a(()=>[...n[3]||(n[3]=[m(" قم بتعديل بيانات الطلب وحفظ التغييرات ",-1)])]),_:1})]),_:1}),o("div",pe,[o("div",ve,[s(r(j),{for:"order_delivery_cost"},{default:a(()=>[...n[4]||(n[4]=[m("تكلفة توصيل",-1)])]),_:1}),s(r(M),{id:"order_delivery_cost",type:"number",modelValue:c.value.order_delivery_cost,"onUpdate:modelValue":n[0]||(n[0]=i=>c.value.order_delivery_cost=i),placeholder:"أدخل تكلفة توصيل الطلب (ج.م)"},null,8,["modelValue"])]),o("div",ge,[s(r(j),{for:"order_total_price"},{default:a(()=>[...n[5]||(n[5]=[m("إجمالي السعر (ج.م)",-1)])]),_:1}),s(r(M),{id:"order_total_price",modelValue:c.value.order_total_price,"onUpdate:modelValue":n[1]||(n[1]=i=>c.value.order_total_price=i),modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"0.00"},null,8,["modelValue"])]),o("div",ye,[s(r(j),{for:"notes"},{default:a(()=>[...n[6]||(n[6]=[m("ملاحظات",-1)])]),_:1}),s(r(te),{id:"notes",modelValue:c.value.notes,"onUpdate:modelValue":n[2]||(n[2]=i=>c.value.notes=i),placeholder:"أضف ملاحظات إضافية (اختياري)",rows:"3"},null,8,["modelValue"])])]),s(r(Q),null,{default:a(()=>[s(r(w),{variant:"outline",onClick:y,disabled:u.value},{default:a(()=>[...n[7]||(n[7]=[m(" إلغاء ",-1)])]),_:1},8,["disabled"]),s(r(w),{onClick:k,disabled:u.value},{default:a(()=>[m(p(u.value?"جاري الحفظ...":"حفظ التغييرات"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),be={class:"border border-border rounded-lg p-4"},$e={class:"flex items-start justify-between mb-4"},ke={class:"space-y-1"},we={class:"flex items-center gap-2"},Ce={class:"font-bold text-primary"},he={class:"ml-1 capitalize"},Se={class:"text-sm text-muted-foreground"},Ve={class:"flex flex-col items-end gap-1"},Pe={class:"font-bold text-lg"},Ue={class:"font-bold text-lg"},Te={class:"order-items"},Be=["src"],De={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ze={class:"text-sm text-muted-foreground"},je={class:"flex gap-2"},Ee={class:"flex flex-col space-y-2"},Ie={key:0,class:"bonus btns space-x-1 md:space-x-2"},Oe=L({__name:"OrderCard",props:{order:{}},emits:["edit-click"],setup(d,{emit:S}){const x=S,$=q(),u=(i,t)=>{U.put(`/orders/${i}?update_status=true`,{order_status:t,restaurant_id:$.user.id}).then(v=>{C.success("تم تحديث حالة الطلب بنجاح!")}).catch(v=>{C.error("فشل في تحديث حالة الطلب.")})},c=(i,t)=>{x("edit-click",i,t)},y=(i,t,v)=>{const D=t.order_delivery_cost+v;U.put(`/orders/${i}`,{order_total_price:t.order_total_price,order_delivery_cost:D,notes:t.order_notes,restaurant_id:t.restaurant_id}).then(z=>{C.success("تم تحديث تكلفة التوصيل بنجاح!")}).catch(z=>{C.error("فشل في تحديث تكلفة التوصيل.")})};function k(i){switch(i){case"preparing":return T(B,{class:"h-4 w-4"});case"ready":return T(ie,{class:"h-4 w-4"});case"picked-up":return T(ne,{class:"h-4 w-4"});default:return T(B,{class:"h-4 w-4"})}}function f(i){switch(i){case"preparing":return"bg-yellow-500/10 text-yellow-500 border-yellow-500/20";case"ready":return"bg-green-500/10 text-green-500 border-green-500/20";case"picked-up":return"bg-primary/10 text-primary border-primary/20";default:return"bg-gray-500/10 text-gray-500 border-gray-500/20"}}function n(i){switch(i){case"preparing":return"في التحضير";case"ready":return"جاهز للاستلام";case"picked-up":return"تم الاستلام";case"delivered":return"تم التوصيل";default:return"في التحضير"}}return(i,t)=>(g(),V("div",be,[o("div",$e,[o("div",ke,[o("div",we,[o("span",Ce,"#"+p(d.order.order_id),1),s(r(le),{class:re(f(d.order.order_status))},{default:a(()=>[(g(),h(se(k(d.order.order_status)),{class:"h-3 w-3"})),o("span",he,p(n(d.order.order_status)),1)]),_:1},8,["class"])]),o("p",Se,p(d.order.created_at.replace("T"," ").split(".")[0]),1)]),o("div",Ve,[o("span",Pe,p(d.order.order_total_price)+" ج.م ",1),o("span",Ue,p(d.order.order_delivery_cost)+" ج.م ",1)])]),o("div",Te,[o("img",{src:"https://deliveryshop.cloud"+d.order.order_receipt,alt:"Receipt Image",class:"h-36 w-36 rounded-md object-cover mr-2"},null,8,Be)]),o("div",De,[o("div",null,[t[5]||(t[5]=o("p",{class:"font-medium"},"ملاحظات",-1)),o("p",ze,p(d.order.order_notes),1)])]),o("div",je,[d.order.order_status==="preparing"?(g(),h(r(w),{key:0,size:"sm",class:"bg-green-600 hover:bg-green-700",onClick:t[0]||(t[0]=v=>u(d.order.order_id,"ready"))},{default:a(()=>[...t[6]||(t[6]=[m(" جاهز للاستلام ",-1)])]),_:1})):P("",!0),d.order.order_status!=="delivered"?(g(),h(r(w),{key:1,size:"sm",class:"bg-blue-600 hover:bg-blue-700",onClick:t[1]||(t[1]=v=>c(d.order,!0))},{default:a(()=>[s(r(_e),{class:"h-4 w-4 mr-2"}),t[7]||(t[7]=m(" تعديل ",-1))]),_:1})):P("",!0)]),o("div",Ee,[t[11]||(t[11]=o("span",null,"إضافة علي التوصيل",-1)),d.order.order_status!=="delivered"?(g(),V("div",Ie,[s(r(w),{onClick:t[2]||(t[2]=v=>y(d.order.order_id,d.order,5))},{default:a(()=>[...t[8]||(t[8]=[m("+5 ج.م",-1)])]),_:1}),s(r(w),{onClick:t[3]||(t[3]=v=>y(d.order.order_id,d.order,10))},{default:a(()=>[...t[9]||(t[9]=[m("+10 ج.م",-1)])]),_:1}),s(r(w),{onClick:t[4]||(t[4]=v=>y(d.order.order_id,d.order,15))},{default:a(()=>[...t[10]||(t[10]=[m("+15 ج.م",-1)])]),_:1})])):P("",!0)])]))}}),Fe={class:"p-6",dir:"rtl"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},Le={class:"text-2xl font-bold text-primary"},Me={class:"text-2xl font-bold text-green-500"},Ae={class:"mb-4 text-sm text-muted-foreground"},qe={class:"space-y-4"},He={key:0,class:"text-center py-8"},bt=L({__name:"HomePage",setup(d){const S=q(),x=_(0),$=_([]),u=_([]),c=_(!1),y=_(""),k=_(!1),f=_({}),n=_({}),{messages:i}=ce(S.user?.id||0),t=_(1),v=_(50),D=oe(()=>Math.ceil(n.value.sum_of_orders/v.value)),z=async()=>{c.value=!0;const e=new Date().toISOString().split("T")[0];try{const l=await U.get(`/orders?from=${e}&to=${e}`);u.value=l.data.orders}catch(l){y.value=l.message||"Failed to fetch restaurants"}finally{c.value=!1}},H=async()=>{c.value=!0;const e=new Date().toISOString().split("T")[0];try{const l=await U.get(`/orders?from=${e}&to=${e}&status=true&page=${t.value}`);n.value=l.data.stats||{},console.log("Status:",l.data.stats)}catch(l){console.error("Failed to fetch stats:",l)}finally{c.value=!1}};return ae(()=>{z(),H()}),N(i,b=>{const e=b[b.length-1];e&&(e.type==="new_order"&&(C.success("تم انشاء طلب جديد!"),u.value.push(e.order)),e.type==="updated_order"&&(u.value=u.value.map(l=>(l.order_id===e.order.order_id&&(console.log("Updating order:",e.order,l),l=e.order),l))),e.type==="order_status_updated"&&(console.log("Order status updated:",e.order),u.value=u.value.map(l=>(l.order_id===e.order.order_id&&(l.order_status=e.order.order_status),l))))},{immediate:!0,deep:!0}),N(u,b=>{$.value=b.filter(e=>e.order_status!=="delivered"),x.value=b.filter(e=>e.order_status==="delivered").length},{immediate:!0,deep:!0}),(b,e)=>(g(),V(A,null,[s(Z),o("div",Fe,[o("div",Ne,[s(r(E),null,{default:a(()=>[s(r(I),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(r(O),{class:"text-sm font-medium"},{default:a(()=>[...e[2]||(e[2]=[m("طلبات قيد الانتظار",-1)])]),_:1}),s(r(B),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(r(F),null,{default:a(()=>[o("div",Le,p($.value.length),1),e[3]||(e[3]=o("p",{class:"text-xs text-muted-foreground"},"محتاجة متابعة",-1))]),_:1})]),_:1}),s(r(E),null,{default:a(()=>[s(r(I),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(r(O),{class:"text-sm font-medium"},{default:a(()=>[...e[4]||(e[4]=[m("تم تسليمها النهارده",-1)])]),_:1}),s(r(fe),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(r(F),null,{default:a(()=>[o("div",Me,p(x.value),1),e[5]||(e[5]=o("p",{class:"text-xs text-muted-foreground"},"طلبات تم تسليمها",-1))]),_:1})]),_:1})]),o("p",Ae," استعرض كل الطلبات بين التاريخين المحددين (صفحة "+p(t.value)+" من "+p(D.value)+") ",1),s(r(E),null,{default:a(()=>[s(r(I),null,{default:a(()=>[s(r(O),null,{default:a(()=>[...e[6]||(e[6]=[m("الطلبات الحالية",-1)])]),_:1}),s(r(ue),null,{default:a(()=>[...e[7]||(e[7]=[m(" تابع الطلبات اللي شغالة دلوقتي وعدّل حالتها ",-1)])]),_:1})]),_:1}),s(r(F),null,{default:a(()=>[o("div",qe,[(g(!0),V(A,null,de($.value,l=>(g(),h(Oe,{order:l,key:l.order_id,onEditClick:(R,W)=>{f.value=R,k.value=W}},null,8,["order","onEditClick"]))),128)),u.value.length?P("",!0):(g(),V("div",He,[s(r(B),{class:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e[8]||(e[8]=o("p",{class:"text-muted-foreground"},"مافيش طلبات شغالة دلوقتي",-1)),e[9]||(e[9]=o("p",{class:"text-sm text-muted-foreground"},"أي طلب جديد هيظهر هنا",-1))])),!c.value&&u.value.length>0?(g(),h(me,{key:1,"current-page":t.value,"total-items":n.value.sum_of_orders,"items-per-page":v.value,"onUpdate:currentPage":e[0]||(e[0]=l=>t.value=l)},null,8,["current-page","total-items","items-per-page"])):P("",!0)])]),_:1})]),_:1})]),s(xe,{open:k.value,"onUpdate:open":e[1]||(e[1]=l=>k.value=l),order:f.value},null,8,["open","order"])],64))}});export{bt as default};

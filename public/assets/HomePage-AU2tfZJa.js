import{_ as Z,a as ee,b as te,c as se,d as oe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DSSqtd07.js";import{_ as re,a as ae}from"./Header.vue_vue_type_script_setup_true_lang-D13dtg7P.js";import{c as de,_ as h,g as ne,a as ie,b as le,d as ue,C as W}from"./index-CQf1Xhsn.js";import{_ as F}from"./Input.vue_vue_type_script_setup_true_lang-Bj6C5Fsj.js";import{_ as D}from"./Label.vue_vue_type_script_setup_true_lang-Bql-k3-N.js";import{_ as ce}from"./Textarea.vue_vue_type_script_setup_true_lang-Bz25nc14.js";import{d as z,r as g,v as P,k as S,w as i,e as s,f as b,b as r,a as n,i as v,t as x,x as U,s as C,u as R,c as N,n as fe,l as me,m as T,y as A,z as _e,o as pe,F as L,j as ve}from"./index-TZd6v5Hm.js";import{_ as ge,a as ye}from"./CustomPagination.vue_vue_type_script_setup_true_lang-C56SBDgm.js";import{_ as O,a as E,b as I,c as M}from"./CardTitle.vue_vue_type_script_setup_true_lang--LHH3i02.js";import{_ as xe}from"./CardDescription.vue_vue_type_script_setup_true_lang-Bq6xeI4W.js";import{C as $e}from"./circle-check-big-47wU_KPo.js";import"./PopperContent--wvMB_Ff.js";import"./index-D4VFAAJq.js";import"./x-Dv3lmHrD.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-o64Dm6M0.js";import"./check-BuCm8Ksx.js";import"./SelectLabel.vue_vue_type_script_setup_true_lang-D9EsVPvK.js";import"./loader-DHQJhs53.js";import"./index-DSgkQ9qN.js";const be=de("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),we={class:"grid gap-4 py-4"},ke={class:"grid gap-2"},he={class:"grid gap-2"},Ce={class:"grid gap-2"},Se=z({__name:"EditOrders",props:{open:{type:Boolean},order:{}},emits:["update:open"],setup(o,{emit:m}){const c=o,_=m,l=g(!1),f=g({order_total_price:0,order_delivery_cost:0,notes:"",restaurant_id:0});P(()=>c.order,e=>{e&&(f.value={order_total_price:e.order_total_price||0,order_delivery_cost:e.order_delivery_cost||0,notes:e.order_notes||"",restaurant_id:e.restaurant_id})},{immediate:!0});const a=()=>{_("update:open",!1)},p=async()=>{if(c.order){l.value=!0;try{await U.put(`/orders/${c.order.order_id}`,f.value),C.success("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!"),a()}catch(e){C.error(e.response?.data?.message||"ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨")}finally{l.value=!1}}};return(e,d)=>(b(),S(s(Z),{open:o.open,"onUpdate:open":a},{default:i(()=>[r(s(oe),{class:"sm:max-w-[600px]",dir:"rtl"},{default:i(()=>[r(s(ee),null,{default:i(()=>[r(s(te),null,{default:i(()=>[v("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ #"+x(o.order?.order_id),1)]),_:1}),r(s(re),null,{default:i(()=>[...d[3]||(d[3]=[v(" Ù‚Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ÙˆØ­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ",-1)])]),_:1})]),_:1}),n("div",we,[n("div",ke,[r(s(D),{for:"order_delivery_cost"},{default:i(()=>[...d[4]||(d[4]=[v("ØªÙƒÙ„ÙØ© ØªÙˆØµÙŠÙ„",-1)])]),_:1}),r(s(F),{id:"order_delivery_cost",type:"number",modelValue:f.value.order_delivery_cost,"onUpdate:modelValue":d[0]||(d[0]=y=>f.value.order_delivery_cost=y),placeholder:"Ø£Ø¯Ø®Ù„ ØªÙƒÙ„ÙØ© ØªÙˆØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ (Ø¬.Ù…)"},null,8,["modelValue"])]),n("div",he,[r(s(D),{for:"order_total_price"},{default:i(()=>[...d[5]||(d[5]=[v("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¹Ø± (Ø¬.Ù…)",-1)])]),_:1}),r(s(F),{id:"order_total_price",modelValue:f.value.order_total_price,"onUpdate:modelValue":d[1]||(d[1]=y=>f.value.order_total_price=y),modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"0.00"},null,8,["modelValue"])]),n("div",Ce,[r(s(D),{for:"notes"},{default:i(()=>[...d[6]||(d[6]=[v("Ù…Ù„Ø§Ø­Ø¸Ø§Øª",-1)])]),_:1}),r(s(ce),{id:"notes",modelValue:f.value.notes,"onUpdate:modelValue":d[2]||(d[2]=y=>f.value.notes=y),placeholder:"Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",rows:"3"},null,8,["modelValue"])])]),r(s(se),null,{default:i(()=>[r(s(h),{variant:"outline",onClick:a,disabled:l.value},{default:i(()=>[...d[7]||(d[7]=[v(" Ø¥Ù„ØºØ§Ø¡ ",-1)])]),_:1},8,["disabled"]),r(s(h),{onClick:p,disabled:l.value},{default:i(()=>[v(x(l.value?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...":"Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),Ne={class:"border border-border rounded-lg p-4"},Te={class:"flex items-start justify-between mb-4"},Ue={class:"space-y-1"},Ve={class:"flex items-center gap-2"},Pe={class:"font-bold text-primary"},De={class:"ml-1 capitalize"},Oe={class:"text-sm text-muted-foreground"},Ee={class:"text-sm text-muted-foreground"},Ie={class:"flex flex-col items-end gap-1"},Me={class:"font-bold text-lg"},je={class:"font-bold text-lg"},ze={class:"order-items"},Be=["src"],We={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Fe={class:"text-sm text-muted-foreground"},Le={class:"flex gap-2"},Je={class:"flex flex-col space-y-2"},qe={key:0,class:"bonus btns space-x-1 md:space-x-2"},Re=z({__name:"OrderCard",props:{order:{}},emits:["edit-click"],setup(o,{emit:m}){const c=m,_=R(),l=(p,e)=>{U.put(`/orders/${p}?update_status=true`,{order_status:e,restaurant_id:_.user.id}).then(d=>{C.success("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!")}).catch(d=>{C.error("ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨.")})},f=(p,e)=>{c("edit-click",p,e)},a=(p,e,d)=>{const y=e.order_delivery_cost+d;U.put(`/orders/${p}`,{order_total_price:e.order_total_price,order_delivery_cost:y,notes:e.order_notes,restaurant_id:e.restaurant_id}).then(k=>{C.success("ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!")}).catch(k=>{C.error("ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„.")})};return(p,e)=>(b(),N("div",Ne,[n("div",Te,[n("div",Ue,[n("div",Ve,[n("span",Pe,"#"+x(o.order.order_id),1),r(s(ge),{class:fe(s(ne)(o.order.order_status))},{default:i(()=>[(b(),S(me(s(ie)(o.order.order_status)),{class:"h-3 w-3"})),n("span",De,x(s(le)(o.order.order_status)),1)]),_:1},8,["class"])]),n("p",Oe,x(o.order.created_at.replace("T"," ").split(".")[0]),1),n("p",Ee,x(s(ue)(o.order.payment_method)),1)]),n("div",Ie,[n("span",Me,x(o.order.order_total_price)+" Ø¬.Ù… ",1),n("span",je,x(o.order.order_delivery_cost)+" Ø¬.Ù… ",1)])]),n("div",ze,[n("img",{src:"https://deliveryshop.cloud"+o.order.order_receipt,alt:"Receipt Image",class:"h-36 w-36 rounded-md object-cover mr-2"},null,8,Be)]),n("div",We,[n("div",null,[e[5]||(e[5]=n("p",{class:"font-medium"},"Ù…Ù„Ø§Ø­Ø¸Ø§Øª",-1)),n("p",Fe,x(o.order.order_notes),1)])]),n("div",Le,[o.order.order_status==="preparing"?(b(),S(s(h),{key:0,size:"sm",class:"bg-green-600 hover:bg-green-700",onClick:e[0]||(e[0]=d=>l(o.order.order_id,"ready"))},{default:i(()=>[...e[6]||(e[6]=[v(" Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… ",-1)])]),_:1})):T("",!0),o.order.order_status!=="delivered"?(b(),S(s(h),{key:1,size:"sm",class:"bg-blue-600 hover:bg-blue-700",onClick:e[1]||(e[1]=d=>f(o.order,!0))},{default:i(()=>[r(s(be),{class:"h-4 w-4 mr-2"}),e[7]||(e[7]=v(" ØªØ¹Ø¯ÙŠÙ„ ",-1))]),_:1})):T("",!0)]),n("div",Je,[e[11]||(e[11]=n("span",null,"Ø¥Ø¶Ø§ÙØ© Ø¹Ù„ÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„",-1)),o.order.order_status!=="delivered"?(b(),N("div",qe,[r(s(h),{onClick:e[2]||(e[2]=d=>a(o.order.order_id,o.order,5))},{default:i(()=>[...e[8]||(e[8]=[v("+5 Ø¬.Ù…",-1)])]),_:1}),r(s(h),{onClick:e[3]||(e[3]=d=>a(o.order.order_id,o.order,10))},{default:i(()=>[...e[9]||(e[9]=[v("+10 Ø¬.Ù…",-1)])]),_:1}),r(s(h),{onClick:e[4]||(e[4]=d=>a(o.order.order_id,o.order,15))},{default:i(()=>[...e[10]||(e[10]=[v("+15 Ø¬.Ù…",-1)])]),_:1})])):T("",!0)])]))}}),$=g(null),j=g(!1),J=g([]),Ae="wss://deliveryshop.cloud";function He(o,m){if(!("Notification"in window)){console.warn("This browser does not support desktop notifications.");return}Notification.permission==="granted"?new Notification(o,{body:m}):Notification.permission!=="denied"&&Notification.requestPermission().then(c=>{c==="granted"&&new Notification(o,{body:m})})}function Ge(o){function m(){$.value=new WebSocket(Ae),$.value.onopen=()=>{j.value=!0,console.log("âœ… WebSocket connected"),$.value?.send(JSON.stringify({type:"restaurant_init",restaurant_id:o}))},$.value.onmessage=_=>{const l=JSON.parse(_.data);J.value.push(l),l.type==="order_assaging_failed"&&He("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨",`Ø§Ù„Ø·Ù„Ø¨ Ø±Ù‚Ù… ${l.order_id} Ù„Ù… ÙŠØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!`),console.log("ðŸ“© New message:",l)},$.value.onclose=()=>{j.value=!1,console.warn("âŒ WebSocket disconnected, reconnecting..."),setTimeout(m,3e3)},$.value.onerror=_=>{console.error("WebSocket error:",_),$.value?.close()}}return m(),A(()=>$.value?.close()),{ws:$,isConnected:j,messages:J,sendMessage:_=>{$.value&&$.value.readyState===WebSocket.OPEN&&$.value.send(JSON.stringify(_))}}}function q(o,m){if(!("Notification"in window)){console.warn("This browser does not support desktop notifications.");return}Notification.permission==="granted"?new Notification(o,{body:m}):Notification.permission!=="denied"&&Notification.requestPermission().then(c=>{c==="granted"&&new Notification(o,{body:m})})}function Ke(o,m){const c=new Map;function _(a){c.has(a)&&(clearInterval(c.get(a)),c.delete(a))}function l(){o.value.forEach(a=>{const p=a.order_id;_(p);const e=window.setInterval(()=>{const d=Date.now();if(!(a.order_status==="delivered"||a.order_status==="picked_up")){if(a.order_status==="preparing"){const y=new Date(a.created_at).getTime(),k=(d-y)/6e4;k>=21&&!a._late_preparing_sent&&(m({type:"late_preparing_order",order_id:a.order_id}),q("Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ù„Ø¨ ÙŠØ³ØªØºØ±Ù‚ ÙˆÙ‚ØªØ§ Ø·ÙˆÙŠÙ„Ø§",`ØªÙ… Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ ${a.order_id} Ø®Ø° ${k} Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ù„ØªØ­Ø¶ÙŠØ±`),a._late_preparing_sent=!0)}if(a.order_status==="ready"){const y=new Date(a.ready_at).getTime();(d-y)/6e4>=41&&!a._late_pickup_sent&&(m({type:"late_pickup_order",order_id:a.order_id}),q("Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø¨Ù„ Ø£ÙŠ Ø³Ø§Ø¦Ù‚ Ù…Ù†Ø° ÙØªØ±Ø© Ø·ÙˆÙŠÙ„Ø©","Ø³ÙŠØªÙ… Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†"),a._late_pickup_sent=!0)}}},1e4);c.set(p,e)})}function f(a){_(a)}return P(o,a=>{l(),c.forEach((p,e)=>{a.find(d=>d.order_id===e)||_(e)})},{deep:!0,immediate:!0}),A(()=>{c.forEach(a=>clearInterval(a)),c.clear()}),{startTimers:l,stopTimer:f}}const Qe={class:"p-6",dir:"rtl"},Xe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},Ye={class:"text-2xl font-bold text-primary"},Ze={class:"text-2xl font-bold text-green-500"},et={class:"mb-4 text-sm text-muted-foreground"},tt={class:"space-y-4"},st={key:0,class:"text-center py-8"},wt=z({__name:"HomePage",setup(o){const m=R(),c=g(0),_=g([]),l=g([]),f=g(!1),a=g(""),p=g(!1),e=g({}),d=g({}),{messages:y,sendMessage:k}=Ge(m.user?.id||0),V=g(1),B=g(50),H=_e(()=>Math.ceil(d.value.sum_of_orders/B.value)),G=async()=>{f.value=!0;const t=new Date().toISOString().split("T")[0];try{const u=await U.get(`/orders?from=${t}&to=${t}`);l.value=u.data.orders}catch(u){a.value=u.message||"Failed to fetch restaurants"}finally{f.value=!1}},K=async()=>{f.value=!0;const t=new Date().toISOString().split("T")[0];try{const u=await U.get(`/orders?from=${t}&to=${t}&status=true&page=${V.value}`);d.value=u.data.stats||{},console.log("Status:",u.data.stats)}catch(u){console.error("Failed to fetch stats:",u)}finally{f.value=!1}},{startTimers:Q}=Ke(l,k);return pe(async()=>{await G(),await K(),Q()}),P(y,w=>{const t=w[w.length-1];t&&(t.type==="new_order"&&(C.success("ØªÙ… Ø§Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯!"),l.value.push(t.order)),t.type==="updated_order"&&(l.value=l.value.map(u=>(u.order_id===t.order.order_id&&(console.log("Updating order:",t.order,u),u=t.order),u))),t.type==="order_status_updated"&&(console.log("Order status updated:",t.order),l.value=l.value.map(u=>(u.order_id===t.order.order_id&&(u.order_status=t.order.order_status),u))))},{immediate:!0,deep:!0}),P(l,w=>{_.value=w.filter(t=>t.order_status!=="delivered"),c.value=w.filter(t=>t.order_status==="delivered").length},{immediate:!0,deep:!0}),(w,t)=>(b(),N(L,null,[r(ae),n("div",Qe,[n("div",Xe,[r(s(O),null,{default:i(()=>[r(s(E),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:i(()=>[r(s(I),{class:"text-sm font-medium"},{default:i(()=>[...t[2]||(t[2]=[v("Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",-1)])]),_:1}),r(s(W),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),r(s(M),null,{default:i(()=>[n("div",Ye,x(_.value.length),1),t[3]||(t[3]=n("p",{class:"text-xs text-muted-foreground"},"Ù…Ø­ØªØ§Ø¬Ø© Ù…ØªØ§Ø¨Ø¹Ø©",-1))]),_:1})]),_:1}),r(s(O),null,{default:i(()=>[r(s(E),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:i(()=>[r(s(I),{class:"text-sm font-medium"},{default:i(()=>[...t[4]||(t[4]=[v("ØªÙ… ØªØ³Ù„ÙŠÙ…Ù‡Ø§ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡",-1)])]),_:1}),r(s($e),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),r(s(M),null,{default:i(()=>[n("div",Ze,x(c.value),1),t[5]||(t[5]=n("p",{class:"text-xs text-muted-foreground"},"Ø·Ù„Ø¨Ø§Øª ØªÙ… ØªØ³Ù„ÙŠÙ…Ù‡Ø§",-1))]),_:1})]),_:1})]),n("p",et," Ø§Ø³ØªØ¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨ÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ† (ØµÙØ­Ø© "+x(V.value)+" Ù…Ù† "+x(H.value)+") ",1),r(s(O),null,{default:i(()=>[r(s(E),null,{default:i(()=>[r(s(I),null,{default:i(()=>[...t[6]||(t[6]=[v("Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©",-1)])]),_:1}),r(s(xe),null,{default:i(()=>[...t[7]||(t[7]=[v(" ØªØ§Ø¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù„ÙŠ Ø´ØºØ§Ù„Ø© Ø¯Ù„ÙˆÙ‚ØªÙŠ ÙˆØ¹Ø¯Ù‘Ù„ Ø­Ø§Ù„ØªÙ‡Ø§ ",-1)])]),_:1})]),_:1}),r(s(M),null,{default:i(()=>[n("div",tt,[(b(!0),N(L,null,ve(_.value,u=>(b(),S(Re,{order:u,key:u.order_id,onEditClick:(X,Y)=>{e.value=X,p.value=Y}},null,8,["order","onEditClick"]))),128)),l.value.length?T("",!0):(b(),N("div",st,[r(s(W),{class:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),t[8]||(t[8]=n("p",{class:"text-muted-foreground"},"Ù…Ø§ÙÙŠØ´ Ø·Ù„Ø¨Ø§Øª Ø´ØºØ§Ù„Ø© Ø¯Ù„ÙˆÙ‚ØªÙŠ",-1)),t[9]||(t[9]=n("p",{class:"text-sm text-muted-foreground"},"Ø£ÙŠ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù‡ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§",-1))])),!f.value&&l.value.length>0?(b(),S(ye,{key:1,"current-page":V.value,"total-items":d.value.sum_of_orders,"items-per-page":B.value,"onUpdate:currentPage":t[0]||(t[0]=u=>V.value=u)},null,8,["current-page","total-items","items-per-page"])):T("",!0)])]),_:1})]),_:1})]),r(Se,{open:p.value,"onUpdate:open":t[1]||(t[1]=u=>p.value=u),order:e.value},null,8,["open","order"])],64))}});export{wt as default};

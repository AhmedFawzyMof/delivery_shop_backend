import{d as M,f as x,e as c,q as $,b as e,a as o,u as r,t as l,w as a,c as D,y as z,o as p,F as P,l as T,k as i,z as U,h as q,x as A,C as X,D as H,n as J}from"./index-BG9mr9sY.js";import{_ as K}from"./index-moM4Hlrc.js";import{_ as w}from"./createLucideIcon-C7aeWmm-.js";import{_ as F,a as O,b as V,c as y}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Jci9uzpm.js";import{_ as Q,E as W}from"./CustomPagination.vue_vue_type_script_setup_true_lang-me83O7Ey.js";import{_ as Y}from"./Sidebar.vue_vue_type_script_setup_true_lang-C1nDLJ_-.js";import{_ as Z,a as ee,b as te,c as se,d as re}from"./SelectValue.vue_vue_type_script_setup_true_lang-B0LCxo-J.js";import{X as oe}from"./x-M69NQ4bB.js";import{S as de,F as L}from"./search-Cnx9-tui.js";import{E as ne}from"./eye-C5XdxVN6.js";import"./index-Di9DkWXL.js";import"./useForwardPropsEmits-_dF8l01g.js";import"./Teleport-DPIMwWOF.js";import"./PopperContent-yyM1vckF.js";import"./RovingFocusGroup-zpvSgXPB.js";import"./Collection-CcbLNy-t.js";import"./house-D-GpzwGF.js";import"./truck-DcYqb-mC.js";import"./mail-DwJQQ0yg.js";import"./check-Dwe0Yga7.js";const le={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},ae={class:"bg-card border border-border rounded-lg max-w-2xl w-full max-h-[90vh] overflow-auto"},ue={class:"flex items-center justify-between p-6 border-b border-border sticky top-0 bg-card"},ie={class:"p-6 space-y-6",dir:"rtl"},pe={class:"grid grid-cols-2 gap-6"},fe={class:"text-lg font-bold text-foreground"},xe={class:"text-lg font-bold text-primary capitalize"},me={class:"bg-muted/30 rounded-lg p-4 space-y-3"},ce={class:"grid grid-cols-2 gap-4"},ge={class:"text-sm text-foreground"},ve={class:"text-sm text-foreground"},_e={class:"col-span-2"},be={class:"text-sm text-foreground"},ye={class:"bg-muted/30 rounded-lg p-4 space-y-3"},$e={class:"grid grid-cols-2 gap-4"},we={class:"text-sm text-foreground"},ke={class:"text-sm text-foreground"},Ce={class:"col-span-2"},he={class:"text-sm text-foreground"},Se={key:0,class:"bg-muted/30 rounded-lg p-4 space-y-3"},De={class:"grid grid-cols-2 gap-4"},Ee={class:"text-sm text-foreground"},Fe={class:"text-sm text-foreground"},Oe={class:"text-sm text-foreground capitalize"},Ve={class:"text-sm text-foreground"},ze={key:1,class:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-4"},Pe={class:"bg-muted/30 rounded-lg p-4 space-y-3"},Te={class:"space-y-2 text-sm"},je={class:"flex justify-between"},Be={class:"text-foreground font-medium"},Ue={class:"flex justify-between"},Le={class:"text-foreground font-medium"},Me={class:"border-t border-border pt-2 flex justify-between"},Ne={class:"text-foreground font-bold"},Ge={key:2,class:"bg-muted/30 rounded-lg p-4"},Re={class:"text-sm text-foreground"},Ie={class:"text-xs text-muted-foreground"},qe={key:0,class:"w-full flex px-6 gap-3 my-3",dir:"rtl"},Ae={class:"flex gap-3 p-6 border-t border-border bg-muted/20"},Xe=M({__name:"OrderDitails",props:{order:{},isOpen:{type:Boolean},onEdit:{type:Function},onClose:{type:Function}},setup(j){const d=j;function k(g){switch(g){case"preparing":return"في التحضير";case"ready":return"جاهز للاستلام";case"picked-up":return"تم الاستلام";case"delivered":return"تم التوصيل";default:return"في التحضير"}}const m=x(!1),b=x([]),v=x(null),_=x(!1),h=async()=>{try{_.value=!0;const g=await z.get(`/driver?active=true&city=${d.order.restaurant_city}`);b.value=g.data.drivers,m.value=!0}catch(g){console.error("حدث خطأ أثناء جلب السائقين:",g)}finally{_.value=!1}},S=async()=>{if(!v.value)return alert("اختر سائق أولاً");try{await z.post(`/orders/assign/${d.order.order_id}`,{driver_id:v.value}),U.success("تم تعيين السائق بنجاح"),m.value=!1,d.onEdit()}catch(g){console.error("حدث خطأ أثناء تعيين السائق:",g),U.error("فشل تعيين السائق")}};return(g,t)=>d.isOpen?(p(),c("div",le,[e("div",ae,[e("div",ue,[t[3]||(t[3]=e("h2",{class:"text-xl font-bold text-foreground"},"تفاصيل الطلب",-1)),e("button",{onClick:t[0]||(t[0]=(...f)=>d.onClose&&d.onClose(...f)),class:"p-1 hover:bg-muted rounded transition-colors"},[o(r(oe),{class:"w-5 h-5 text-foreground"})])]),e("div",ie,[e("div",pe,[e("div",null,[t[4]||(t[4]=e("p",{class:"text-xs text-muted-foreground uppercase"},"رقم الطلب",-1)),e("p",fe," #"+l(d.order.order_id),1)]),e("div",null,[t[5]||(t[5]=e("p",{class:"text-xs text-muted-foreground uppercase"},"الحالة",-1)),e("p",xe,l(k(d.order.order_status)),1)])]),e("div",me,[t[9]||(t[9]=e("h3",{class:"font-semibold text-foreground"},"معلومات العميل",-1)),e("div",ce,[e("div",null,[t[6]||(t[6]=e("p",{class:"text-xs text-muted-foreground"},"الاسم",-1)),e("p",ge,l(d.order.user_name||"غير معروف"),1)]),e("div",null,[t[7]||(t[7]=e("p",{class:"text-xs text-muted-foreground"},"الهاتف",-1)),e("p",ve,l(d.order?.user_phone||"غير متوفر"),1)]),e("div",_e,[t[8]||(t[8]=e("p",{class:"text-xs text-muted-foreground"},"العنوان",-1)),e("p",be,l(d.order?.user_address||"غير متوفر"),1)])])]),e("div",ye,[t[13]||(t[13]=e("h3",{class:"font-semibold text-foreground"},"معلومات المطعم",-1)),e("div",$e,[e("div",null,[t[10]||(t[10]=e("p",{class:"text-xs text-muted-foreground"},"الاسم",-1)),e("p",we,l(d.order?.restaurant_name||"غير معروف"),1)]),e("div",null,[t[11]||(t[11]=e("p",{class:"text-xs text-muted-foreground"},"المدينة",-1)),e("p",ke,l(d.order?.restaurant_city||"غير متوفر"),1)]),e("div",Ce,[t[12]||(t[12]=e("p",{class:"text-xs text-muted-foreground"},"العنوان",-1)),e("p",he,l(d.order?.restaurant_address||"غير متوفر"),1)])])]),d.order.driver_id?(p(),c("div",Se,[t[18]||(t[18]=e("h3",{class:"font-semibold text-foreground"},"معلومات السائق",-1)),e("div",De,[e("div",null,[t[14]||(t[14]=e("p",{class:"text-xs text-muted-foreground"},"الاسم",-1)),e("p",Ee,l(d.order.driver_full_name),1)]),e("div",null,[t[15]||(t[15]=e("p",{class:"text-xs text-muted-foreground"},"الهاتف",-1)),e("p",Fe,l(d.order.driver_phone),1)]),e("div",null,[t[16]||(t[16]=e("p",{class:"text-xs text-muted-foreground"},"المركبة",-1)),e("p",Oe,l(d.order.driver_type),1)]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-xs text-muted-foreground"},"رقم اللوحة",-1)),e("p",Ve,l(d.order.plate_number),1)])])])):(p(),c("div",ze,[...t[19]||(t[19]=[e("p",{class:"text-sm text-orange-700"}," لم يتم تعيين سائق لهذا الطلب بعد ",-1)])])),e("div",Pe,[t[23]||(t[23]=e("h3",{class:"font-semibold text-foreground"},"ملخص الطلب",-1)),e("div",Te,[e("div",je,[t[20]||(t[20]=e("span",{class:"text-muted-foreground"},"إجمالي الطلب:",-1)),e("span",Be,l(d.order.order_total_price)+" ج.م",1)]),e("div",Ue,[t[21]||(t[21]=e("span",{class:"text-muted-foreground"},"تكلفة التوصيل:",-1)),e("span",Le,l(d.order.order_delivery_cost)+" ج.م",1)]),e("div",Me,[t[22]||(t[22]=e("span",{class:"text-foreground font-medium"},"الإجمالي الكلي:",-1)),e("span",Ne,l(d.order.order_total_price)+" ج.م",1)])])]),d.order.order_notes?(p(),c("div",Ge,[t[24]||(t[24]=e("h3",{class:"font-semibold text-foreground mb-2"},"ملاحظات",-1)),e("p",Re,l(d.order.order_notes),1)])):$("",!0),e("div",Ie," تم إنشاء الطلب في "+l(new Date(d.order.created_at).toLocaleString("ar-EG")),1)]),m.value?(p(),c("div",qe,[o(r(Z),{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=f=>v.value=f)},{default:a(()=>[o(r(ee),{class:"w-[200px]"},{default:a(()=>[o(r(te),{placeholder:"اختر سائقًا"})]),_:1}),o(r(se),null,{default:a(()=>[(p(!0),c(P,null,T(b.value,f=>(p(),D(r(re),{key:f.driver_id,value:f.driver_id.toString()},{default:a(()=>[i(l(f.driver_name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),o(r(w),{onClick:S,disabled:!v.value},{default:a(()=>[...t[25]||(t[25]=[i("حفظ",-1)])]),_:1},8,["disabled"]),o(r(w),{onClick:t[2]||(t[2]=f=>m.value=!1),variant:"outline"},{default:a(()=>[...t[26]||(t[26]=[i("اغلاق",-1)])]),_:1})])):$("",!0),e("div",Ae,[o(r(w),{onClick:d.onClose,variant:"outline"},{default:a(()=>[...t[27]||(t[27]=[i("إغلاق",-1)])]),_:1},8,["onClick"]),!m.value&&d.order.order_status!=="delivered"?(p(),D(r(w),{key:0,onClick:h,disabled:_.value},{default:a(()=>[i(l(_.value?"جارٍ التحميل...":"تعيين سائق"),1)]),_:1},8,["disabled"])):$("",!0)])])])):$("",!0)}}),He={class:"flex h-screen bg-background"},Je={class:"w-full flex flex-col p-8 space-y-6"},Ke={class:"flex flex-col sm:flex-row gap-4"},Qe={class:"flex-1 relative"},We={class:"flex gap-2"},Ye={class:"bg-card border border-border rounded-lg overflow-hidden"},Ze={class:"overflow-x-auto"},et={class:"w-full"},tt={key:0},st={class:"px-6 py-4 text-sm font-medium text-foreground"},rt={class:"px-6 py-4 text-sm text-foreground"},ot={class:"px-6 py-4 text-sm text-foreground"},dt={class:"px-6 py-4 text-sm font-medium text-foreground"},nt={class:"px-6 py-4 text-sm text-foreground"},lt={class:"px-6 py-4 text-sm text-foreground"},at={class:"px-6 py-4"},ut={class:"px-6 py-4 text-sm text-muted-foreground"},it={class:"px-6 py-4 text-right"},pt={class:"p-1.5 hover:bg-muted rounded transition-colors"},ft=50,Pt=M({__name:"OrdersPage",setup(j){const d=x(""),k=x(null),m=x(null),b=x(1),v=x(null),_=x(!1),h=x(0),S=x([]);function g(u,s=500){let n;return(...E)=>{clearTimeout(n),n=window.setTimeout(()=>u(...E),s)}}const t=x([]),f=async()=>{try{const u=new URLSearchParams;u.append("page",b.value.toString()),d.value.trim()!==""&&u.append("search",encodeURIComponent(d.value.trim())),k.value&&u.append("status",k.value),m.value&&u.append("city",m.value);const s=await z.get(`/orders/admin?${u.toString()}`,{});t.value=s.data.orders,h.value=s.data.totalOrders,S.value=s.data.cities.map(n=>n.city_name)}catch(u){console.error("حدث خطأ أثناء جلب البيانات:",u)}};q(async()=>{await f()});const N=g(f,500),C=u=>{k.value=u,b.value=1,f()},B=u=>{m.value=u,b.value=1,f()},G=u=>{switch(u){case"pending":return"bg-orange-500/10 text-orange-700 hover:bg-orange-500/20";case"assigned":return"bg-blue-500/10 text-blue-700 hover:bg-blue-500/20";case"delivered":return"bg-green-500/10 text-green-700 hover:bg-green-500/20";default:return"bg-gray-500/10 text-gray-700 hover:bg-gray-500/20"}};function R(u){switch(u){case"preparing":return"في التحضير";case"ready":return"جاهز للاستلام";case"picked-up":return"تم الاستلام";case"delivered":return"تم التوصيل";default:return"في التحضير"}}function I(u){v.value=u,_.value=!0}return A(d,()=>{N()}),(u,s)=>(p(),c("div",He,[o(Y),e("div",Je,[s[20]||(s[20]=e("div",null,[e("h1",{class:"text-3xl font-bold text-foreground"},"الطلبات"),e("p",{class:"text-muted-foreground mt-1"}," إدارة ومتابعة جميع طلبات التوصيل ")],-1)),e("div",Ke,[e("div",Qe,[o(r(de),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),X(e("input",{type:"text",placeholder:"ابحث برقم الطلب...","onUpdate:modelValue":s[0]||(s[0]=n=>d.value=n),class:"w-full pl-10 pr-4 py-2 bg-card border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[H,d.value]])]),e("div",We,[o(r(F),null,{default:a(()=>[o(r(O),{asChild:""},{default:a(()=>[o(r(w),{variant:"outline",size:"sm",class:"gap-2 bg-transparent"},{default:a(()=>[o(r(L),{class:"w-4 h-4"}),i(" "+l(m.value?`المدينة: ${m.value}`:"المدينة"),1)]),_:1})]),_:1}),o(r(V),null,{default:a(()=>[o(r(y),{onClick:s[1]||(s[1]=n=>B(null))},{default:a(()=>[...s[10]||(s[10]=[i("كل المدن",-1)])]),_:1}),(p(!0),c(P,null,T(S.value,n=>(p(),D(r(y),{key:n,onClick:E=>B(n)},{default:a(()=>[i(l(n),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),o(r(F),null,{default:a(()=>[o(r(O),{asChild:""},{default:a(()=>[o(r(w),{variant:"outline",size:"sm",class:"gap-2 bg-transparent"},{default:a(()=>[o(r(L),{class:"w-4 h-4"}),s[11]||(s[11]=i(" الحالة ",-1))]),_:1})]),_:1}),o(r(V),null,{default:a(()=>[o(r(y),{onClick:s[2]||(s[2]=n=>C(null))},{default:a(()=>[...s[12]||(s[12]=[i(" كل الطلبات ",-1)])]),_:1}),o(r(y),{onClick:s[3]||(s[3]=n=>C("pending"))},{default:a(()=>[...s[13]||(s[13]=[i(" قيد الانتظار ",-1)])]),_:1}),o(r(y),{onClick:s[4]||(s[4]=n=>C("ready"))},{default:a(()=>[...s[14]||(s[14]=[i(" جاهز للاستلام ",-1)])]),_:1}),o(r(y),{onClick:s[5]||(s[5]=n=>C("picked-up"))},{default:a(()=>[...s[15]||(s[15]=[i(" تم التعيين ",-1)])]),_:1}),o(r(y),{onClick:s[6]||(s[6]=n=>C("delivered"))},{default:a(()=>[...s[16]||(s[16]=[i(" تم التسليم ",-1)])]),_:1})]),_:1})]),_:1})])]),e("div",Ye,[e("div",Ze,[e("table",et,[s[19]||(s[19]=e("thead",null,[e("tr",{class:"border-b border-border bg-muted/30"},[e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," رقم الطلب "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," العميل "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," المطعم "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," الإجمالي "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," التوصيل "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," السائق "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," الحالة "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase"}," التاريخ "),e("th",{class:"px-6 py-4 text-right text-xs font-medium text-muted-foreground uppercase"}," الإجراءات ")])],-1)),e("tbody",null,[t.value.length===0?(p(),c("tr",tt,[...s[17]||(s[17]=[e("td",{colspan:"9",class:"px-6 py-8 text-center text-muted-foreground"}," لا يوجد طلبات ",-1)])])):$("",!0),(p(!0),c(P,null,T(t.value,n=>(p(),c("tr",{key:n.order_id,class:"border-b border-border hover:bg-muted/50 transition-colors"},[e("td",st," #"+l(n.order_id),1),e("td",rt,l(n.user_name),1),e("td",ot,l(n.restaurant_name),1),e("td",dt," ج.م "+l(n.order_total_price.toFixed(2)),1),e("td",nt," ج.م "+l(n.order_delivery_cost.toFixed(2)),1),e("td",lt,l(n.driver_full_name||"غير مخصص"),1),e("td",at,[o(r(K),{class:J(G(n.order_status))},{default:a(()=>[i(l(R(n.order_status)),1)]),_:2},1032,["class"])]),e("td",ut,l(new Date(n.created_at).toLocaleDateString("ar-EG")),1),e("td",it,[o(r(F),null,{default:a(()=>[o(r(O),{asChild:""},{default:a(()=>[e("button",pt,[o(r(W),{class:"w-4 h-4 text-muted-foreground"})])]),_:1}),o(r(V),{align:"end"},{default:a(()=>[o(r(y),{onClick:E=>I(n)},{default:a(()=>[o(r(ne),{class:"w-4 h-4 mr-2"}),s[18]||(s[18]=i(" عرض التفاصيل ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)])]))),128))])])]),o(Q,{"current-page":b.value,"total-items":h.value,"items-per-page":ft,"onUpdate:currentPage":s[7]||(s[7]=n=>b.value=n)},null,8,["current-page","total-items"])]),v.value?(p(),D(Xe,{key:0,order:v.value,isOpen:_.value,onClose:s[8]||(s[8]=n=>_.value=!1),onEdit:s[9]||(s[9]=()=>{_.value=!1,f()})},null,8,["order","isOpen"])):$("",!0)])]))}});export{Pt as default};

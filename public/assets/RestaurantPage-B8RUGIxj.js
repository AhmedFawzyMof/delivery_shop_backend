import{d as P,M as z,r as g,v as D,c as p,m as U,a as e,b as d,e as n,N as f,O as v,F as w,j as V,S as M,t as _,k as $,w as m,x as T,s as R,f as u,i as c,o as Y,n as X,g as Z}from"./index-TZd6v5Hm.js";import{a as ee,E as te,_ as se}from"./CustomPagination.vue_vue_type_script_setup_true_lang-C56SBDgm.js";import{_ as j}from"./index-CQf1Xhsn.js";import{_ as oe,B as re}from"./Sidebar.vue_vue_type_script_setup_true_lang-Ckioauwz.js";import{_ as q,b as G,c as H,d as O}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-g-Y2GW1p.js";import{h as E}from"./hasPermission-zJzLI1JE.js";import{X as J}from"./x-Dv3lmHrD.js";import{S as A}from"./star-CpxeQ8Aq.js";import{S as ne,F as le}from"./search-CJLom1ik.js";import{E as ae}from"./eye-CSdyFiDX.js";import{C as ue}from"./circle-check-big-47wU_KPo.js";import{B as de}from"./ban-BwVuZAnJ.js";import"./index-D4VFAAJq.js";import"./PopperContent--wvMB_Ff.js";const ie={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},me={class:"bg-card border border-border rounded-lg max-w-2xl w-full max-h-[90vh] overflow-auto"},pe={class:"flex items-center justify-between p-6 border-b border-border sticky top-0 bg-card"},fe={class:"p-6 space-y-6"},ce={class:"flex items-start gap-4"},ge={class:"w-16 h-16 rounded-lg bg-muted flex items-center justify-center text-4xl"},ve=["src","alt"],be={class:"flex-1 space-y-2"},xe={class:"flex items-center gap-2 mt-2"},_e={class:"bg-muted/30 rounded-lg p-4 space-y-3"},ye={class:"grid grid-cols-2 gap-4"},we=["value"],$e={class:"col-span-2"},Ce={class:"col-span-2"},ke={class:"bg-muted/30 rounded-lg p-4"},Ue={class:"bg-muted/30 rounded-lg p-4"},Ve={class:"text-xs text-muted-foreground"},Re={class:"flex gap-3 p-6 border-t border-border bg-muted/20"},Se=P({__name:"RestaurantDetailModal",props:{restaurant:{},cities:{},isOpen:{type:Boolean},onClose:{type:Function},onEdit:{type:Function}},setup(B){const i=B,C=z(),y=g(i.isOpen);D(()=>i.isOpen,b=>{y.value=b});const o=g({...i.restaurant}),k=async()=>{try{await T.put(`/restaurants/${o.value.restaurant_id}`,o.value),i.onEdit(),R.success("تم التحديث بنجاح")}catch(b){console.error(b),R.error("فشل في التحديث")}};return D(()=>i.restaurant,b=>{console.log("newVal",b),o.value={...b}}),(b,s)=>y.value?(u(),p("div",ie,[e("div",me,[e("div",pe,[s[10]||(s[10]=e("h2",{class:"text-xl font-bold text-foreground"},"تفاصيل المطعم",-1)),e("button",{onClick:s[0]||(s[0]=(...t)=>i.onClose&&i.onClose(...t)),class:"p-1 hover:bg-muted rounded transition-colors"},[d(n(J),{class:"w-5 h-5 text-foreground"})])]),e("div",fe,[e("div",ce,[e("div",ge,[e("img",{src:`https://deliveryshop.cloud/${o.value.logo_image}`,alt:`${o.value.restaurant_name} logo`},null,8,ve)]),e("div",be,[f(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>o.value.restaurant_name=t),class:"w-full text-2xl font-bold text-foreground border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.restaurant_name]]),e("div",xe,[(u(!0),p(w,null,V(o.value.rate||0,t=>(u(),$(n(A),{key:t,class:"w-4 h-4 fill-yellow-500 text-yellow-500"}))),128)),f(e("input",{type:"number","onUpdate:modelValue":s[2]||(s[2]=t=>o.value.rate=t),min:"0",max:"5",class:"w-12 text-sm text-muted-foreground border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.rate]]),s[11]||(s[11]=e("span",{class:"text-sm text-muted-foreground"},"تقييم",-1))])])]),e("div",_e,[s[16]||(s[16]=e("h3",{class:"font-semibold text-foreground"},"المعلومات الأساسية",-1)),e("div",ye,[e("div",null,[s[12]||(s[12]=e("p",{class:"text-xs text-muted-foreground"},"المدينة",-1)),f(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>o.value.restaurant_city=t),class:"text-sm font-medium w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},[(u(!0),p(w,null,V(B.cities,t=>(u(),p("option",{value:t.city_name},_(t.city_name),9,we))),256))],512),[[M,o.value.restaurant_city]])]),e("div",null,[s[13]||(s[13]=e("p",{class:"text-xs text-muted-foreground"},"السجل التجاري",-1)),f(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>o.value.commercial_register=t),class:"text-sm text-foreground font-mono w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.commercial_register]])]),e("div",$e,[s[14]||(s[14]=e("p",{class:"text-xs text-muted-foreground"},"العنوان",-1)),f(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>o.value.address=t),class:"text-sm text-foreground w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.address]])]),e("div",Ce,[s[15]||(s[15]=e("p",{class:"text-xs text-muted-foreground"},"الموقع (الإحداثيات)",-1)),f(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>o.value.location=t),class:"text-sm text-foreground font-mono w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.location]])])])]),e("div",ke,[s[18]||(s[18]=e("p",{class:"text-xs text-muted-foreground uppercase mb-2"},"الحالة",-1)),f(e("select",{"onUpdate:modelValue":s[7]||(s[7]=t=>o.value.is_baned=t),class:"text-sm font-medium w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},[...s[17]||(s[17]=[e("option",{value:!0},"محظور",-1),e("option",{value:!1},"نشط",-1)])],512),[[M,o.value.is_baned]])]),e("div",Ue,[s[19]||(s[19]=e("label",{class:"text-xs text-muted-foreground uppercase mb-2"}," كلمة المرور ",-1)),f(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>o.value.password=t),placeholder:"يرجى تركه كما هو إذا كنت لا تريد تغييره",class:"text-sm text-foreground font-mono w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.password]])]),e("div",Ve," تم إنشاء المطعم في "+_(o.value?new Date(o.value.created_at).toLocaleString():""),1)]),e("div",Re,[d(n(j),{onClick:i.onClose,variant:"outline"},{default:m(()=>[...s[20]||(s[20]=[c("إغلاق",-1)])]),_:1},8,["onClick"]),n(E)(n(C).user.data?.role.permissions,"restaurant:edit")?(u(),$(n(j),{key:0,onClick:s[9]||(s[9]=t=>k())},{default:m(()=>[...s[21]||(s[21]=[c("حفظ التعديلات",-1)])]),_:1})):U("",!0)])])])):U("",!0)}}),je={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},Be={class:"bg-card border border-border rounded-lg max-w-2xl w-full max-h-[90vh] overflow-auto"},Fe={class:"flex items-center justify-between p-6 border-b border-border sticky top-0 bg-card"},Oe={class:"p-6 space-y-6"},Ee={class:"flex items-start gap-4"},Le={class:"w-16 h-16 rounded-lg bg-muted flex items-center justify-center overflow-hidden"},he=["src"],De={key:1,class:"text-muted-foreground text-xs"},Me={class:"flex-1 space-y-2"},Te={class:"flex items-center gap-2 mt-2"},Ne={class:"bg-muted/30 rounded-lg p-4 space-y-3"},Pe={class:"grid grid-cols-2 gap-4"},ze=["value"],Ae={class:"col-span-2"},Ie={class:"col-span-2"},Xe={class:"bg-muted/30 rounded-lg p-4"},qe={class:"bg-muted/30 rounded-lg p-4"},Ge={class:"flex gap-3 p-6 border-t border-border bg-muted/20"},He=P({__name:"CreateRestaurantModal",props:{cities:{},isOpen:{type:Boolean},onClose:{type:Function},onCreate:{type:Function}},setup(B){const i=B,C=z(),y=g(i.isOpen);D(()=>i.isOpen,s=>y.value=s);const o=g({restaurant_name:"",restaurant_city:"",logo_file:null,logo_preview:"",address:"",commercial_register:"",location:"",rate:0,is_baned:!1,password:""}),k=s=>{const t=s.target;if(t.files&&t.files[0]){const a=t.files[0];o.value.logo_file=a,o.value.logo_preview=URL.createObjectURL(a)}},b=async()=>{try{const s=new FormData;s.append("restaurant_name",o.value.restaurant_name),s.append("restaurant_city",o.value.restaurant_city),s.append("address",o.value.address),s.append("commercial_register",o.value.commercial_register),s.append("location",o.value.location),s.append("rate",o.value.rate.toString()),s.append("is_baned",o.value.is_baned.toString()),s.append("password",o.value.password),o.value.logo_file&&s.append("logo",o.value.logo_file),await T.post("/restaurants",s,{headers:{"Content-Type":"multipart/form-data"}}),R.success("تم إنشاء المطعم بنجاح"),i.onCreate(),i.onClose()}catch(s){console.error(s),R.error("فشل في إنشاء المطعم")}};return(s,t)=>y.value?(u(),p("div",je,[e("div",Be,[e("div",Fe,[t[10]||(t[10]=e("h2",{class:"text-xl font-bold text-foreground"},"إنشاء مطعم جديد",-1)),e("button",{onClick:t[0]||(t[0]=(...a)=>i.onClose&&i.onClose(...a)),class:"p-1 hover:bg-muted rounded transition-colors"},[d(n(J),{class:"w-5 h-5 text-foreground"})])]),e("div",Oe,[e("div",Ee,[e("div",Le,[o.value.logo_preview?(u(),p("img",{key:0,src:o.value.logo_preview,class:"w-full h-full object-cover"},null,8,he)):(u(),p("span",De,"Logo"))]),e("input",{type:"file",accept:"image/*",onChange:k,class:"text-sm mt-2"},null,32),e("div",Me,[f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.restaurant_name=a),placeholder:"اسم المطعم",class:"w-full text-2xl font-bold text-foreground border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.restaurant_name]]),e("div",Te,[(u(!0),p(w,null,V(o.value.rate,a=>(u(),$(n(A),{key:a,class:"w-4 h-4 fill-yellow-500 text-yellow-500"}))),128)),f(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=a=>o.value.rate=a),min:"0",max:"5",class:"w-12 text-sm text-muted-foreground border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.rate]]),t[11]||(t[11]=e("span",{class:"text-sm text-muted-foreground"},"تقييم",-1))])])]),e("div",Ne,[t[16]||(t[16]=e("h3",{class:"font-semibold text-foreground"},"المعلومات الأساسية",-1)),e("div",Pe,[e("div",null,[t[12]||(t[12]=e("p",{class:"text-xs text-muted-foreground"},"المدينة",-1)),f(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>o.value.restaurant_city=a),class:"text-sm font-medium w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},[(u(!0),p(w,null,V(i.cities,a=>(u(),p("option",{value:a.city_name},_(a.city_name),9,ze))),256))],512),[[M,o.value.restaurant_city]])]),e("div",null,[t[13]||(t[13]=e("p",{class:"text-xs text-muted-foreground"},"السجل التجاري",-1)),f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>o.value.commercial_register=a),class:"text-sm text-foreground w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.commercial_register]])]),e("div",Ae,[t[14]||(t[14]=e("p",{class:"text-xs text-muted-foreground"},"العنوان",-1)),f(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>o.value.address=a),class:"text-sm text-foreground w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.address]])]),e("div",Ie,[t[15]||(t[15]=e("p",{class:"text-xs text-muted-foreground"},"الموقع (الإحداثيات)",-1)),f(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>o.value.location=a),class:"text-sm text-foreground font-mono w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.location]])])])]),e("div",Xe,[t[18]||(t[18]=e("p",{class:"text-xs text-muted-foreground uppercase mb-2"},"الحالة",-1)),f(e("select",{"onUpdate:modelValue":t[7]||(t[7]=a=>o.value.is_baned=a),class:"text-sm font-medium w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},[...t[17]||(t[17]=[e("option",{value:!0},"محظور",-1),e("option",{value:!1},"نشط",-1)])],512),[[M,o.value.is_baned]])]),e("div",qe,[t[19]||(t[19]=e("label",{class:"text-xs text-muted-foreground uppercase mb-2"}," كلمة المرور ",-1)),f(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>o.value.password=a),placeholder:"كلمة مرور الدخول",class:"text-sm text-foreground font-mono w-full border-b border-border focus:outline-none focus:ring-1 focus:ring-primary"},null,512),[[v,o.value.password]])])]),e("div",Ge,[d(n(j),{onClick:i.onClose,variant:"outline"},{default:m(()=>[...t[20]||(t[20]=[c("إغلاق",-1)])]),_:1},8,["onClick"]),n(E)(n(C).user.data?.role.permissions,"restaurant:create")?(u(),$(n(j),{key:0,onClick:t[9]||(t[9]=a=>b())},{default:m(()=>[...t[21]||(t[21]=[c(" إنشاء ",-1)])]),_:1})):U("",!0)])])])):U("",!0)}}),Je={class:"p-4 flex flex-col items-center sm:flex-row gap-4"},Ke={class:"flex-1 relative"},Qe={class:"flex gap-2"},We={dir:"rtl",class:"space-y-4 p-4"},Ye={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Ze={class:"p-4 border-b border-border flex items-start justify-between"},et={class:"flex items-start gap-3 flex-1"},tt={class:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center text-2xl"},st=["src","alt"],ot={class:"flex-1 min-w-0"},rt={class:"font-semibold text-foreground truncate"},nt={class:"text-xs text-muted-foreground"},lt={class:"p-1 hover:bg-muted rounded transition-colors"},at={class:"p-4 space-y-3"},ut={class:"flex items-center justify-between"},dt={class:"flex items-center gap-1"},it={class:"text-xs font-medium text-muted-foreground"},mt={class:"text-xs space-y-1"},pt={class:"text-muted-foreground"},ft={class:"text-muted-foreground truncate"},ct={class:"flex gap-2 pt-2"},gt={key:1,class:"col-span-full text-center py-12"},Bt=P({__name:"RestaurantPage",setup(B){const i=g(""),C=g(null),y=g(1),o=g(null),k=g(!1),b=g(new Set),s=g([]),t=z(),a=Z(),L=g([]),N=g([]),h=g(!1),S=async()=>{try{const x=new URLSearchParams;x.append("page",y.value.toString()),i.value.trim()!==""&&x.append("search",encodeURIComponent(i.value.trim())),C.value&&x.append("city",C.value);const r=await T.get(`/restaurants?${x.toString()}`);s.value=r.data.restaurants.totalCount,N.value=r.data.restaurants.result,L.value=r.data.cities}catch{R.error("فشل في جلب المطاعم")}},I=x=>{C.value=x,y.value=1,S()},K=async(x,r)=>{try{(await T.put(`/restaurants/${x}?ban=${r}`)).data.success&&S(),R.success("تم تغيير حالة المطعم")}catch{R.error("فشل في تغيير حالة المطعم")}};function Q(x,r=500){let l;return(...F)=>{clearTimeout(l),l=window.setTimeout(()=>x(...F),r)}}const W=Q(S,500);return Y(async()=>{await S()}),D(i,()=>{W()}),(x,r)=>(u(),p(w,null,[d(oe),r[17]||(r[17]=e("div",{class:"p-4",dir:"rtl"},[e("h1",{class:"text-3xl font-bold text-foreground"},"المطاعم"),e("p",{class:"text-muted-foreground mt-1"},"إدارة المطاعم الشريكة وتفاصيلها")],-1)),e("div",Je,[e("div",Ke,[d(n(ne),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),f(e("input",{type:"text",placeholder:"ابحث بالاسم أو المدينة...","onUpdate:modelValue":r[0]||(r[0]=l=>i.value=l),class:"w-full pl-10 pr-4 py-2 bg-card border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[v,i.value]])]),e("div",Qe,[d(n(q),null,{default:m(()=>[d(n(G),{asChild:""},{default:m(()=>[d(n(j),{variant:"outline",class:"gap-2 bg-transparent"},{default:m(()=>[d(n(le),{class:"w-4 h-4"}),c(" "+_(C.value?`المدينة: ${C.value}`:"المدينة"),1)]),_:1})]),_:1}),d(n(H),null,{default:m(()=>[d(n(O),{onClick:r[1]||(r[1]=l=>I(null))},{default:m(()=>[...r[8]||(r[8]=[c(" كل المدن ",-1)])]),_:1}),(u(!0),p(w,null,V(L.value.map(l=>l.city_name),l=>(u(),$(n(O),{key:l,onClick:F=>I(l)},{default:m(()=>[c(_(l),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),n(E)(n(t).user.data?.role.permissions,"restaurant:create")?(u(),$(n(j),{key:0,onClick:r[2]||(r[2]=l=>h.value=!0)},{default:m(()=>[...r[9]||(r[9]=[c(" إنشاء مطعم ",-1)])]),_:1})):U("",!0)]),e("div",We,[e("div",Ye,[N.value.length>0?(u(!0),p(w,{key:0},V(N.value,l=>(u(),p("div",{key:l.restaurant_id,class:X(["bg-card border rounded-lg overflow-hidden transition-all",b.value.has(l.restaurant_id)?"border-red-500/50 bg-red-500/5":"border-border hover:border-primary hover:shadow-lg"])},[e("div",Ze,[e("div",et,[e("div",tt,[e("img",{src:`https://deliveryshop.cloud/${l.logo_image}`,alt:`${l.restaurant_name} logo`},null,8,st)]),e("div",ot,[e("h3",rt,_(l.restaurant_name),1),e("p",nt,_(l.restaurant_city),1)])]),d(n(q),null,{default:m(()=>[d(n(G),{asChild:""},{default:m(()=>[e("button",lt,[d(n(te),{class:"w-4 h-4 text-muted-foreground"})])]),_:1}),d(n(H),{align:"end"},{default:m(()=>[d(n(O),{onClick:()=>{o.value=l,k.value=!0}},{default:m(()=>[d(n(ae),{class:"w-4 h-4 mr-2"}),r[10]||(r[10]=c(" عرض التفاصيل ",-1))]),_:1},8,["onClick"]),n(E)(n(t).user.data?.role.permissions,"restaurant:edit")?(u(),$(n(O),{key:0,onClick:()=>{n(a).push(`/management/restaurant/${l.restaurant_id}/earnings`)}},{default:m(()=>[d(n(re),{class:"w-4 h-4 mr-2"}),r[11]||(r[11]=c(" عرض الأرباح ",-1))]),_:1},8,["onClick"])):U("",!0),n(E)(n(t).user.data?.role.permissions,"restaurant:edit")?(u(),$(n(O),{key:1,onClick:F=>K(l.restaurant_id,!l.is_baned)},{default:m(()=>[b.value.has(l.restaurant_id)?(u(),p(w,{key:0},[d(n(ue),{class:"w-4 h-4 mr-2"}),r[12]||(r[12]=c(" إلغاء الحظر ",-1))],64)):(u(),p(w,{key:1},[d(n(de),{class:"w-4 h-4 mr-2"}),r[13]||(r[13]=c(" حظر ",-1))],64))]),_:2},1032,["onClick"])):U("",!0)]),_:2},1024)]),_:2},1024)]),e("div",at,[e("div",ut,[e("div",dt,[(u(!0),p(w,null,V(l.rate,F=>(u(),$(n(A),{key:F,class:"w-4 h-4 fill-yellow-500 text-yellow-500"}))),128))]),e("span",it,_(l.rate)+".0 تقييم",1)]),e("div",mt,[e("p",pt,[r[14]||(r[14]=e("span",{class:"font-medium text-foreground"},"رقم السجل التجاري:",-1)),c(" "+_(l.commercial_register),1)]),e("p",ft,[r[15]||(r[15]=e("span",{class:"font-medium text-foreground"},"العنوان:",-1)),c(" "+_(l.address),1)])]),e("div",ct,[d(n(se),{class:X(l.is_baned?"bg-red-500/20 text-red-600":"bg-green-500/20 text-green-600")},{default:m(()=>[c(_(l.is_baned?"محظور":"نشط"),1)]),_:2},1032,["class"])])])],2))),128)):(u(),p("div",gt,[...r[16]||(r[16]=[e("p",{class:"text-muted-foreground"},"لا توجد مطاعم",-1)])]))]),d(ee,{"current-page":y.value,"total-items":s.value,"items-per-page":50,"onUpdate:currentPage":r[3]||(r[3]=l=>y.value=l)},null,8,["current-page","total-items"])]),d(He,{cities:L.value,isOpen:h.value,onClose:r[4]||(r[4]=l=>h.value=!1),onCreate:r[5]||(r[5]=()=>{h.value=!1,S()})},null,8,["cities","isOpen"]),o.value?(u(),$(Se,{key:0,restaurant:o.value,cities:L.value,"is-open":k.value,onClose:r[6]||(r[6]=l=>k.value=!1),onEdit:r[7]||(r[7]=()=>{k.value=!1,S()})},null,8,["restaurant","cities","is-open"])):U("",!0)],64))}});export{Bt as default};
